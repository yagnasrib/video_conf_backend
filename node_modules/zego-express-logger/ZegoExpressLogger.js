!function(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n(require("pako/lib/deflate.js"),require("protobufjs/minimal"),require("long"));else if("function"==typeof define&&define.amd)define(["pako/lib/deflate.js","protobufjs/minimal","long"],n);else{var i,e="object"==typeof exports?n(require("pako/lib/deflate.js"),require("protobufjs/minimal"),require("long")):n(t["pako/lib/deflate.js"],t["protobufjs/minimal"],t.long);for(i in e)("object"==typeof exports?exports:t)[i]=e[i]}}("undefined"!=typeof self?self:this,function(i,e,r){return u=[function(t,n){t.exports=i},,function(t,n){t.exports=e},function(t,n){t.exports=r},function(R,t,n){"use strict";n.r(t),n.d(t,"ZegoLogger",function(){return rn}),n.d(t,"ZegoDataReport",function(){return W}),n.d(t,"createZegoWebSocket",function(){return C}),n.d(t,"LoggerStateCenter",function(){return J});e.getInstance=function(){return e.instance||(e.instance=new e).u(),e.instance},e.prototype.u=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this.h},set:function(t){this.h=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this.v},set:function(t){this.v=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this.g},set:function(t){this.g=t},enumerable:!1,configurable:!0}),e.instance=new e;var o,i,r,J=e;function e(){this.h=!1,this.v=0,this.g=!1}(t=m=m||{})[t.IE=0]="IE",t[t.FIREFOX=1]="FIREFOX",t[t.CHROME=2]="CHROME",t[t.SAFARI=3]="SAFARI",t[t.OPERA=4]="OPERA",t[t.WEIXIN=5]="WEIXIN",t[t.WEIXINMINI=6]="WEIXINMINI",t[t.UNKOWN=7]="UNKOWN",(m=o=o||{})[m.BROWSER=0]="BROWSER",m[m.WEIXINMINI=1]="WEIXINMINI",i=i||{},i[i.DEFAULT=0]="DEFAULT",(t=r=r||{})[t.DISABLE=0]="DISABLE",t[t.WEBSOCKET=1]="WEBSOCKET",t[t.HTTPS=2]="HTTPS";var u={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},M=(0,s.prototype.init=function(){var n=this;this.O&&(this.readyState=0,this.O.onOpen(function(t){n.readyState=n.O.readyState,"function"==typeof n.onopen&&(n.onopen(t),n.O.onClose(function(t){n.readyState=n.O.readyState,"function"==typeof n.onclose&&n.onclose(t)}),n.O.onMessage(function(t){"function"==typeof n.onmessage&&n.onmessage(t)}))}),this.O.onError(function(t){n.readyState=n.O.readyState,"function"==typeof n.onerror&&n.onerror(t)}))},s.prototype.onopen=function(t){},s.prototype.onerror=function(t){},s.prototype.onclose=function(t){},s.prototype.onmessage=function(t){},s.prototype.send=function(t){this.O&&this.O.send({data:t})},s.prototype.close=function(){this.O&&this.O.close()},s);function s(t,n){this.url=t,this.readyState=3,this.init()}function C(t,n,i){return n%2===o.BROWSER?(n=t,(i=i)?i.createSocket(n,1):new WebSocket(n)):new M(t)}var L=function(){return(L=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},W=(c.prototype.newReport=function(t,n){this.dataStatistics[t]={event_time:Date.now(),time_consumed:0,seq:t,error:0,message:"success",event:n,events:[]}},c.prototype.addMsgExt=function(t,n){this.dataStatistics[t]?this.dataStatistics[t].msg_ext=n:console.warn("".concat(t," not exist"))},c.prototype.addMsgInfo=function(t,n){this.dataStatistics[t]?Object.assign(this.dataStatistics[t],n):console.warn("".concat(t," not exist"))},c.prototype.eventStart=function(t,n){this.dataStatistics[t]?null==this.dataStatistics[t].events?this.logger.warn("zd.es.0 no events"):this.dataStatistics[t].events.push({event:n,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no seq match")},c.prototype.eventEnd=function(t,n,i){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e&&0!==e.length){for(var r=e.length-1;0<=r;r--)if(e[r].event==n&&0==e[r].time_consumed){e[r].time_consumed=Date.now()-e[r].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},c.prototype.eventEndWithMsg=function(t,n,i){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var r=e.length-1;0<=r;r--)if(e[r].event==n&&0==e[r].time_consumed){e[r].time_consumed=Date.now()-e[r].event_time,null==e[r].msg_ext&&(e[r].msg_ext={}),e[r].msg_ext=L({},i);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},c.prototype.eventEndWithMsgInfo=function(t,n,i){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var r=e.length-1;0<=r;r--)if(e[r].event==n&&0==e[r].time_consumed){e[r].time_consumed=Date.now()-e[r].event_time,Object.assign(e[r],i);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},c.prototype.addEventInfo=function(t,n,i,e){if(this.dataStatistics[t]){var r=this.dataStatistics[t].events;if(null==r)this.logger.warn("zd.aei.0 no events");else for(var o=r.length-1;0<=o;o--)if(r[o].event==n&&null!=r[o].time_consumed){null==r[o].msg_ext?r[o].msg_ext={}:r[o].msg_ext&&(r[o].msg_ext[i]=e);break}}else this.logger.warn("zd.aei.0 no seq match")},c.prototype.addEventMsg=function(t,n,i,e){if(this.dataStatistics[t]){var r=this.dataStatistics[t].events;if(null==r)this.logger.warn("zd.aem.0 no events");else for(var o=r.length-1;0<=o;o--)if(r[o].event==n){r[o][i]=e;break}}else this.logger.warn("zd.aem.0 no seq match")},c.prototype.addEvent=function(t,n,i){this.dataStatistics[t]?this.dataStatistics[t].events&&(i?this.dataStatistics[t].events.push({event:n,event_time:Date.now(),msg_ext:i}):this.dataStatistics[t].events.push({event:n,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},c.prototype.uploadReport=function(t,n,i,e){var r=this.dataStatistics[t];null!=r&&(n&&(r.event=n),r.time_consumed=Date.now()-r.event_time,i&&this.addMsgInfo(t,{error:i.code,message:i.message||i.msg+" "+(e||"")}),this.logger.report(r),delete this.dataStatistics[t])},c);function c(t){this.dataStatistics={},this.logger=t}var G,f=["00","01","02","03","04","05","06","07","08","09"];function U(){var t=new Date;return[t.getFullYear()+"/",(f[t.getMonth()+1]||t.getMonth()+1)+"/",(f[t.getDate()]||t.getDate())+" ",(f[t.getHours()]||t.getHours())+":",(f[t.getMinutes()]||t.getMinutes())+":",f[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")}(m=G=G||{}).WEBSOCKET_STATE_CHANGE="zl.net.wsc",m.OPEN_WS="zl.net.opws";for(var a=n(2),t=n(3),l=(a.util.Long=t,a.util.Long.fromBits=a.util.Long?a.util.Long.fromBits:function(){return 0},a.roots),$=a.types?a.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},B=a.types?a.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},h=Object.keys($),v={$:function(t){return v[t]?v[t].call(this):l[t].decode?l[t].decode(this,this.uint32()):v.$.call(this,"int32")}},d={$:function(t,n,i){var e=$[t];return void 0===e?l[t].encode?(this.uint32((i<<3|2)>>0).fork(),l[t].encode(n,this).ldelim()):d.$.call(this,"int32",n,i):d[t].call(this.uint32(i<<3|e),n)}},w=0;w<h.length;w++)v[h[w]]=a.Reader.prototype[h[w]],d[h[w]]=a.Writer.prototype[h[w]];!function o(t,u,n,i){for(var e=0,r=Object.keys(t);e<r.length;e++){var s=r[e];if(t[s].$m&&Object.keys(t[s].$m).every(function(t){return Number(t)})){if(n[s])throw Error(`nested type ${n}.${s} has already exist`);n[s]=function(f,t){function h(t){for(var n in f){n=f[n];"{"===n[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[])}if(t)for(var i=Object.keys(t),e=0;e<i.length;++e)null!=t[i[e]]&&(this[i[e]]=t[i[e]])}var n,i={};for(n in f){var e=f[n],r=e[1];"{"===r.charAt(0)?(h.prototype[e[0]]=a.util.emptyObject,i[r]={$m:r.substring(1).split(",").map(function(t,n){return["$"+(n+1),t,null]}).reduce(function(t,n,i){return t[i+1]=n,t},{})}):"["===r.charAt(0)||"<"===r.charAt(0)?h.prototype[e[0]]=a.util.emptyArray:"bytes"===r?h.prototype[e[0]]=a.util.newBuffer([]):e[2]&&e[2].hasOwnProperty("low")&&e[2].hasOwnProperty("high")?h.prototype[e[0]]=a.util.Long.fromBits(e[2].low,e[2].high,e[2].unsigned):h.prototype[e[0]]=e[2]}return h.create=function(t){return new h(t)},h.decode=function(t,n){t instanceof a.Reader||(t=a.Reader.create(t));for(var i=void 0===n?t.len:t.pos+n,e=new h;t.pos<i;){var r=t.uint32(),o=r>>>3;if(0<o&&f[o]){var u=f[o][0];if("{"===(s=f[o][1]).charAt(0)){e[u]===a.util.emptyObject&&(e[u]={});o=h.$namespace[s].decode(t,t.uint32());e[u][o.$1]=o.$2}else if("["===s.charAt(0)||"<"===s.charAt(0)){s=s.substring(1),e[u]&&e[u].length||(e[u]=[]);var s,o=!v[s]&&!l[s].decode;if(void 0!==B[s=o?"int32":s]&&2==(7&r))for(var c=t.uint32()+t.pos;t.pos<c;)e[u].push(v.$.call(t,s));else e[u].push(v.$.call(t,s))}else e[u]=v.$.call(t,s)}else t.skipType(7&r)}return e},h.encode=function(t,n){for(var i in n=n||a.Writer.create(),f){var e=f[i][0];if("{"===(c=f[i][1]).charAt(0)){if(null!=t[e]&&t.hasOwnProperty(e))for(var r=0,o=Object.keys(t[e]);r<o.length;++r)n.uint32((i<<3|2)>>0).fork(),h.$namespace[c].encode({$1:o[r],$2:t[e][o[r]]},n).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var u="<"===c.charAt(0),s=(c=c.substring(1),t[e]);if(null!=s&&s.length){var c=void 0===$[c]&&!l[c].encode?"int32":c;if(u&&void 0!==B[c]){n.uint32((i<<3|2)>>0).fork();for(r=0;r<s.length;r++)d[c].call(n,s[r]);n.ldelim()}else for(r=0;r<s.length;r++)d.$.call(n,c,s[r],i)}}else null!=t[e]&&t.hasOwnProperty(e)&&d.$.call(n,c,t[e],i)}return n},Object.keys(i).length&&(h.$namespace=o(i,u+"."+t,h.$namespace||{},!0)),h}(t[s].$m,s)}else t[s].$s?n[s]=function(n,r){function o(t,n,i){a.rpc.Service.call(this,t,n,i)}return((o.prototype=Object.create(a.rpc.Service.prototype)).constructor=o).create=function(t,n,i){return new o(t,n,i)},Object.keys(n).forEach(function(t){var i=n[t];function e(t,n){return this.rpcCall(e,l[i[0]],l[i[1]],t,n)}Object.defineProperty(e,"name",{value:t}),Object.defineProperty(e,"path",{value:u+"."+r}),o.prototype[t]=e}),o}(t[s].$s,s):t[s].$e&&Object.values(t[s].$e).every(function(t){return Number(t)===t})&&(n[s]=function(t){for(var n=Object.keys(t),i={},e=0;e<n.length;e++)i[i[n[e]]=t[n[e]]]=n[e];return i}(t[s].$e));n[s]&&!i&&(l[u+"."+s]=n[s]),delete t[s].$m,delete t[s].$s,delete t[s].$e,n[s]=o(t[s],u?u+"."+s:s,n[s]||{})}return n}({report:{rtcreport:{DetailLogRequest:{$m:{1:["appid","uint32",0],2:["product","uint32",0],3:["id_name","string",""],4:["timestamp","uint64",{low:0,high:0,unsigned:!0}],5:["litesign","string",""],6:["detail_data","bytes",[]]}},DetailLogResponse:{$m:{1:["code","uint32",0]}}}}},"",l,!1);var X=l.report,F=n(0),H=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},Z=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}};function K(r,o,u){return H(this,void 0,void 0,function(){var n,i,e;return Z(this,function(t){switch(t.label){case 0:return n="",i=function(t){t=t||32;for(var n="abcdefhijkmnprstwxyz0123456789",i=n.length,e="",r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*i));return e}(16),[4,function(e){var r;return H(this,void 0,void 0,function(){var n,i;return Z(this,function(t){switch(t.label){case 0:return n=(new TextEncoder).encode(e),[4,null==(r=crypto.subtle)?void 0:r.digest("SHA-256",n)];case 1:return n=t.sent(),i=Array.from(new Uint8Array(n)),[2,i.map(function(t){return t.toString(16).padStart(2,"0")}).join("")]}})})}("".concat(r).concat("DPIV9g5X2zvTD4Zj").concat(i).concat(u))];case 1:return(e=(e=t.sent()).toLocaleLowerCase())&&(e={ver:o,hash:e,nonce:i,expire:u},e=JSON.stringify(e),n=btoa(e)),[2,n]}})})}var V=function(){return(V=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},Q=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},Y=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},tt=function(t,n,i){if(i||2===arguments.length)for(var e,r=0,o=n.length;r<o;r++)!e&&r in n||((e=e||Array.prototype.slice.call(n,0,r))[r]=n[r]);return t.concat(e||Array.prototype.slice.call(n))},nt=(Object.defineProperty(b.prototype,"url",{get:function(){return this.j.url},set:function(t){this.j.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"strategy",{get:function(){return this.S.strategy},enumerable:!1,configurable:!0}),b.prototype.setStrategy=function(t){this.S.setStrategy(t),this._=this.S.build()},b.prototype.addRemoteWsLog=function(t){var n;if(this.j.env!=o.BROWSER)throw new Error("cannot use net strategy on  mini program");for(this.closed()&&(n=this.url,this.url="",this.openWebSocketLogServer(n)),this.k.push(t);this.k.size()>this.k.logCacheMax;)this.k.pop();this.connected()&&this._&&this._.active()},b.prototype.stopWebSocketServer=function(){this.clearHbTimer(),this.T=void 0,this.O&&(this.O.onclose=null,this.O.onerror=null,this.O.close(),this.O=null)},b.prototype.P=function(){this.O&&this.j.useStrategy&&(this.S.setCache(this.k),this._=this.S.build())},b.prototype.N=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var e=this.A=this.D,r="";switch(t){case"onconnecting":"never_opened"===this.D?this.D="first_connecting":this.D="reconnecting";break;case"onopen":this.D="connected",this.onSocketConnect();break;case"onclosed":this.D="closed";var o=n[0];o&&(r+=" close code=".concat(o.code));break;case"onerror":this.D="error"}t=G.WEBSOCKET_STATE_CHANGE+" log ws state change: ".concat(e," -> ").concat(this.D);r&&(t+=r),"error"===this.D?this.q.warn(t):this.q.info(t)},b.prototype.onSocketConnect=function(){},b.prototype.openWebSocketLogServer=function(t,n,i){var e=this;void 0===n&&(n=!1),((i=void 0===i?!1:i)||this.url!=t)&&((this.url&&""!==this.url||"never_opened"===this.D)&&this.q.info(G.OPEN_WS+" log url change to: ".concat(t)),this.url=t)&&(i=function(){e.I&&(clearTimeout(e.I),e.I=null),e.stopWebSocketServer(),e.O=C(t,e.j.env,e.R),e.O instanceof WebSocket&&(e.O.binaryType="arraybuffer"),e.P(),e.N("onconnecting"),e.O.onopen=function(){var t;e.J=!1,e.T=void 0,e.j.useStrategy&&null!=(t=e._)&&t.active(),e.N("onopen")},e.O.onclose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.J=!1,e.N.apply(e,tt(["onclosed"],t,!1))},e.O.onmessage=e.M.bind(e),e.O.onerror=function(){for(var t=0;t<arguments.length;t++)t,0;e.N("onerror")}},n?i():(n="error"===this.D||"error"===this.A,this.I||(this.I=setTimeout(i,n?5e3:3e3))))},b.prototype.closed=function(){return null==this.O||2==this.O.readyState||3==this.O.readyState},b.prototype.connected=function(){return null!==this.O&&1==this.O.readyState},b.prototype.connecting=function(){return null!==this.O&&0==this.O.readyState},Object.defineProperty(b.prototype,"canSendWs",{get:function(){var t=this.T,t=!t||performance.now()-t<2e4;return!(!this.O||1!==this.O.readyState)&&t},enumerable:!1,configurable:!0}),b.prototype.sendLogFrame=function(i){var e;return Q(this,void 0,void 0,function(){var n;return Y(this,function(t){switch(t.label){case 0:return[4,this.makeLogFrame(i)];case 1:return n=t.sent(),null!=(e=this.O)&&e.send(n),[2]}})})},b.prototype.makeLogFrame=function(f){return Q(this,void 0,void 0,function(){var n,i,e,r,o,u,s,c;return Y(this,function(t){switch(t.label){case 0:return(n=Object(F.deflate)(f),e=this.j,i=e.appid,e=e.userid,r=this.seq++,o=[{}],this.J)?(u={},[3,3]):[3,1];case 1:return c={appid:i,product:2,id_name:e,timestamp:Math.floor(Date.now()/1e3)},[4,function(e){return H(this,void 0,void 0,function(){var n,i;return Z(this,function(t){switch(t.label){case 0:return n="",i=Math.floor((Date.now()+7776e6)/1e3),[4,K(e,2,i)];case 1:return i=t.sent(),[2,n=0<i.length?i:n]}})})}(i)];case 2:c.litesign=t.sent(),u=c,t.label=3;case 3:return s=V.apply(void 0,[V.apply(void 0,o.concat([u])),{detail_data:n}]),s=X.rtcreport.DetailLogRequest.encode(s).finish(),this.J=!0,[2,this.C(r,7,s)]}})})},b.prototype.C=function(t,n,i){var e=(null==i?void 0:i.length)||0,r=new Uint8Array(10+e);return r[0]=64,r[1]=n,r[2]=t>>24&255,r[3]=t>>16&255,r[4]=t>>8&255,r[5]=255&t,r[6]=e>>24&255,r[7]=e>>16&255,r[8]=e>>8&255,r[9]=255&e,i&&r.set(i,10),r},b.prototype.M=function(t){var t=new Uint8Array(t.data),n=t[0];this.T=performance.now(),this.startHbTimer(),64===n&&8===t[1]&&(t[2],t[3],t[4],t[5],n=t[6]<<24|t[7]<<16|t[8]<<8|t[9],t=new Uint8Array(t.slice(10,10+n)),101===X.rtcreport.DetailLogResponse.decode(t).code)&&(this.J=!1)},b.prototype.clearLogCacheAndUpload=function(){var n=this;this.connected()&&this.k.clear().forEach(function(t){n.sendLogFrame(t)})},b.prototype.clearHbTimer=function(){this.checkHbTimer&&(clearTimeout(this.checkHbTimer),this.checkHbTimer=void 0)},b.prototype.startHbTimer=function(){var n=this;this.clearHbTimer(),void 0!==this.T&&6e4<performance.now()-this.T?this.openWebSocketLogServer(this.url,!0,!0):this.checkHbTimer=setTimeout(function(){var t;n.O&&(t=n.C(n.seq++,5),n.O.send(t),n.startHbTimer())},2e4)},b.prototype.destroy=function(){this.O=null},b);function b(t,n,i,e){this.k=t,this.j=n,this.q=i,this.R=e,this.O=null,this.D="never_opened",this.A="never_opened",this.S=new xt(this),this._=null,this.J=!1,this.I=null,this.seq=1,this.T=void 0,this.checkHbTimer=void 0}et.prototype.active=function(){var n=this;this.L.canSendWs&&0!==this.k.size()&&this.W.canSendLog()&&(this.W.getLog().forEach(function(t){n.L.sendLogFrame(t)}),this.W.onSendLog())};var it=et;function et(t,n,i){this.L=t,this.k=n,this.W=i,this.W.onCanSendActive=this.active.bind(this)}function rt(t){this.cache=t}ot=function(t,n){return(ot=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}ot(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(y,ut=rt),y.prototype.getLog=function(){return this.cache.clear()},y.prototype.canSendLog=function(){return 0<this.cache.size()},y.prototype.onSendLog=function(){};var ot,ut,st=y;function y(t){return ut.call(this,t)||this}ct=function(t,n){return(ct=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}ct(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(p,ft=rt),p.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},p.prototype.getLog=function(){for(var t=[],n=0;n<this.maxPacketLen-4e3;){var i=this.cache.getOneLogPacket();if(!i||i.length<=0)break;n+=i.length||0,t.push(i)}return t},p.prototype.onSendLog=function(){var t=this;this.locked=!0,setTimeout(function(){t.locked=!1,t.onCanSendActive&&t.onCanSendActive()},this.maxDelay)};var ct,ft,m=p;function p(){var t=null!==ft&&ft.apply(this,arguments)||this;return t.maxDelay=10,t.maxPacketLen=20480,t.locked=!1,t}ht=function(t,n){return(ht=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}ht(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(vt,at=m);var ht,at,lt=vt;function vt(t){t=at.call(this,t)||this;return t.maxDelay=10,t.maxPacketLen=20480,t}dt=function(t,n){return(dt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var dt,wt;(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}dt(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(bt,wt=m);function bt(){return null!==wt&&wt.apply(this,arguments)||this}yt=function(t,n){return(yt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var yt,mt;(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}yt(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(pt,mt=m);function pt(){return null!==mt&&mt.apply(this,arguments)||this}gt=function(t,n){return(gt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var gt,Ot;(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}gt(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(jt,Ot=m);function jt(){return null!==Ot&&Ot.apply(this,arguments)||this}Object.defineProperty(g.prototype,"strategy",{get:function(){return this.W},enumerable:!1,configurable:!0}),g.prototype.setCache=function(t){this.k=t},g.prototype.setStrategy=function(t){t&&(this.W=t)},g.prototype.build=function(){if(this.k)return this.W!==i.DEFAULT?new it(this.L,this.k,new st(this.k)):new it(this.L,this.k,new lt(this.k));throw new Error("cannot build log sender")};var xt=g;function g(t){this.L=t,this.W=i.DEFAULT}O.G=function(){return!(!window||!window.localStorage)},O.bin2hex=function(t){for(var n,i="",e=0,r=(t+="").length;e<r;e++)i+=(n=t.charCodeAt(e).toString(16)).length<2?"0"+n:n;return i},O.getCanvasFingerprint=function(t){var n=document.createElement("canvas"),i=n.getContext("2d"),i=(i.textBaseline="top",i.font="14px 'Arial'",i.fillStyle="#f60",i.fillRect(125,1,62,20),i.fillStyle="#069",i.fillText(t,2,15),i.fillStyle="rgba(102, 204, 0, 0.7)",i.fillText(t,4,17),n.toDataURL().replace("data:image/png;base64,","")),t=atob(i);return this.bin2hex(t.slice(-16,-12))},O.generateUUID=function(){var i,t,n=localStorage.getItem(this.U);return n||(i=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==t?n:3&n|8).toString(36)}),t=this.getCanvasFingerprint("hello, zego")+n.slice(8),localStorage.setItem(this.U,t),n)},O.id=function(){var t;return O.G()?((t=localStorage.getItem(this.U))||(t=O.generateUUID(),localStorage.setItem(this.U,t)),t):""},O.U="z_deviceID";var St=O;function O(){}var _t=function(){this.url="",this.bakURL="",this.env=o.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=St.id()};Object.defineProperty(j.prototype,"buffer",{get:function(){return this.queue},set:function(t){this.queue=t},enumerable:!1,configurable:!0}),j.prototype.push=function(t){if(!t)throw new Error("item null!");t&&this.queue.push(t)},j.prototype.pop=function(){return this.queue.shift()},j.prototype.front=function(){return this.queue[0]},j.prototype.clear=function(){this.queue=[]};t=j;function j(){this.queue=[]}Et=function(t,n){return(Et=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var Et,kt,Tt=function(){return(Tt=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},Pt=(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}Et(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(x,kt=t),x.prototype.size=function(){return this.queue.length},x.prototype.getOneLogPacket=function(){var t=[],n=0,i="";if(this.size()){var e=JSON.parse(this.queue[this.queue.length-1]).userid,r=this.j.userid||e;if(r){for(;0<this.queue.length;){var o=this.queue[0].length;if(n&&4096<n+o)return i=JSON.stringify(t);var u=JSON.parse(this.queue[0]),u=Tt(Tt({},u),{userid:u.userid||r,roomid:u.roomid||this.j.roomid});n+=o,t.push(u),this.queue.shift()}return""===(i=JSON.stringify(t))?void 0:i}}},x.prototype.clear=function(){for(var t=[];0<this.queue.length;){var n=this.getOneLogPacket();if(!n)break;t.push(n)}return t},x);function x(t,n){void 0===n&&(n=1/0);var i=kt.call(this)||this;return i.logCacheMax=n,i.j=t,i}var Nt=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},At=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Dt=(S.prototype.save=function(t){return this.B.save(this.X,{log:t})},S.prototype.queryList=function(t){return this.B.queryByCursor(this.X,t)},S.prototype.delete=function(t){return this.B.deleteItems(this.X,t)},S.prototype.storedBytesSize=function(){var t=this;return new Promise(function(e,r){return Nt(t,void 0,void 0,function(){var n,i;return At(this,function(t){return n=this.B.openCursor(this.X),i=0,n.onsuccess=function(t){var n,t=null==(t=t.target)?void 0:t.result;t?(n=t.value,i+=n.log.length,t.continue()):e(i)},n.onerror=function(t){r(t)},[2]})})})},S.prototype.lines=function(){return this.B.lines(this.X)},S.prototype.deleteByCount=function(t){return this.B.deleteByCount(this.X,t)},S.prototype.deleteAll=function(){return this.B.deleteAll(this.X)},S);function S(t){this.B=t,this.X="zego_log"}var _=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},E=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},zt=(k.prototype.openDB=function(r){return _(this,void 0,void 0,function(){var i,n,e=this;return E(this,function(t){switch(t.label){case 0:return i=window.indexedDB.open(r.database,r.version),n=this,[4,new Promise(function(n){i.onupgradeneeded=function(t){var i=t.target&&t.target.result;r.tableList.forEach(function(t){var n;i.objectStoreNames.contains(t.tableName)||(n=i.createObjectStore(t.tableName,{keyPath:"id",autoIncrement:!0}),t.tableItems.forEach(function(t){t.index&&n.createIndex(t.itemName,t.itemName,{unique:t.unique})}))})},i.onsuccess=function(t){t=t.target&&t.target.result;e.F=t,n(i)}})];case 1:return n.H=t.sent(),[2]}})})},k.prototype.Z=function(){if(!this.H&&!this.F)throw new Error("indexDB not open")},k.prototype.save=function(o,u){var t=this;return new Promise(function(e,r){return _(t,void 0,void 0,function(){var n,i;return E(this,function(t){return this.Z(),n=this.F.transaction([o],"readwrite").objectStore(o),(i=n.add(u)).onsuccess=function(t){e(i.result)},i.onerror=function(t){r("save item fail")},[2]})})})},k.prototype.update=function(t,n){var i=this;return new Promise(function(t,n){i.Z(),t()})},k.prototype.queryById=function(o,u){var t=this;return new Promise(function(e,r){return _(t,void 0,void 0,function(){var n,i;return E(this,function(t){return this.Z(),n=this.F.transaction([o]).objectStore(o),(i=n.get(u)).onsuccess=function(t){i.result?e(i.result):e(null)},i.onerror=function(t){r()},[2]})})})},k.prototype.queryByCursor=function(o,u){var t=this;return new Promise(function(e,r){return _(t,void 0,void 0,function(){var n,i;return E(this,function(t){return this.Z(),i=this.F.transaction([o]).objectStore(o),n=[],(i=i.openCursor()).onsuccess=function(t){t=null==(t=t.target)?void 0:t.result;t&&(!u||n.length<u)?(n.push(t.value),t.continue()):e(n)},i.onerror=function(t){r()},[2]})})})},k.prototype.lines=function(o){var t=this;return new Promise(function(e,r){return _(t,void 0,void 0,function(){var n,i;return E(this,function(t){return this.Z(),n=this.F.transaction([o]).objectStore(o),n=n.openCursor(),i=0,n.onsuccess=function(t){t=null==(t=t.target)?void 0:t.result;t?(i++,t.continue()):e(i)},n.onerror=function(t){r()},[2]})})})},k.prototype.openCursor=function(t){return this.Z(),this.F.transaction([t]).objectStore(t).openCursor()},k.prototype.deleteById=function(r,o){var t=this;return new Promise(function(i,e){return _(t,void 0,void 0,function(){var n;return E(this,function(t){return this.Z(),n=this.F.transaction([r],"readwrite").objectStore(r),(n=n.delete(o)).onsuccess=function(t){i()},n.onerror=function(t){e()},[2]})})})},k.prototype.deleteByCount=function(r,o){var n=this;return new Promise(function(e,t){return _(n,void 0,void 0,function(){var n,i;return E(this,function(t){switch(t.label){case 0:this.Z(),n=8192,t.label=1;case 1:return 0<o?[4,this.queryByCursor(r,Math.min(o,n))]:[3,4];case 2:return 0===(i=t.sent()).length?[3,4]:(o-=n,[4,this.deleteItems(r,i)]);case 3:return t.sent(),[3,1];case 4:return e(),[2]}})})})},k.prototype.deleteAll=function(r){var t=this;return new Promise(function(i,e){return _(t,void 0,void 0,function(){var n;return E(this,function(t){return this.Z(),n=this.F.transaction([r],"readwrite").objectStore(r),(n=n.clear()).onsuccess=function(t){i()},n.onerror=function(t){e()},[2]})})})},k.prototype.deleteItems=function(i,e){var t=this;return new Promise(function(n){return _(t,void 0,void 0,function(){var r;return E(this,function(t){switch(t.label){case 0:return this.Z(),r=this.F.transaction([i],"readwrite").objectStore(i),[4,Promise.all(e.map(function(e){return new Promise(function(n,i){var t=r.delete(e.id);t.onsuccess=function(t){n()},t.onerror=function(t){i()}})}))];case 1:return t.sent(),n(),[2]}})})})},k);function k(){}var qt={version:1,database:"zego_logger_db",tableList:[{tableName:"zego_log",tableItems:[{itemName:"log",index:!1,unique:!1}]}]};It=function(t,n){return(It=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}It(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(Mt,Rt=t);var It,Rt,Jt=Mt;function Mt(){return null!==Rt&&Rt.apply(this,arguments)||this}var T=function(){return(T=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},Ct=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},Lt=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Wt=(P.prototype.pushTask=function(t,n,i,e,r){t={task:t};n&&(t=T(T({},t),{args:n})),i&&(t=T(T({},t),{successCallback:i})),e&&(t=T(T({},t),{errorCallback:e})),r&&(t=T(T({},t),{completeCallback:r})),this.K.push(t)},P.prototype.V=function(e){return Ct(this,void 0,void 0,function(){var n,i;return Lt(this,function(t){switch(t.label){case 0:n=null,t.label=1;case 1:return(t.trys.push([1,4,5,6]),e&&e.args?n=e.task.apply(e,e.args):e&&(n=e.task()),n instanceof Promise)?[4,n]:[3,3];case 2:n=t.sent(),t.label=3;case 3:return e.successCallback&&e.successCallback(n),[3,6];case 4:if(i=t.sent(),e.errorCallback)return e.errorCallback(i),[3,6];throw i;case 5:return e.completeCallback&&e.completeCallback(),[7];case 6:return[2]}})})},P.prototype.runATask=function(){return Ct(this,void 0,void 0,function(){var n;return Lt(this,function(t){switch(t.label){case 0:return this.K.length<=0?[2]:(n=this.K.shift(),n?[4,this.V(n)]:[3,2]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},P.prototype.runAllTask=function(){return Ct(this,void 0,void 0,function(){var n;return Lt(this,function(t){switch(t.label){case 0:return 0<this.K.length?(n=this.K.shift(),n?[4,this.V(n)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,0];case 3:return[2]}})})},P.prototype.size=function(){return this.K.length},P);function P(){this.K=[]}Ut.prototype.writeLine=function(t){t&&""!==t&&this.Y.push(t)},Ut.prototype.saveAs=function(t,n){var i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=n,i.click()},Ut.prototype.createZip=function(){var t="";0<this.Y.length&&(t=this.Y.join("\n"),this.Y=[]);t=function(t){for(var n,i=0,e=t.length,r="";i<e;)n=t.subarray(i,Math.min(i+32768,e)),r+=String.fromCharCode.apply(null,Array.from(n)),i+=32768;return btoa(r)}(Object(F.deflate)(t));return new Blob([t],{type:"text/plain;charset=utf-8"})};var Gt=Ut;function Ut(){this.Y=[]}var $t=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},Bt=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Xt=(Ft.prototype.tt=function(){return!!(this.j.appid&&this.j.userid&&""!==this.j.userid&&this.j.token&&""!==this.j.token&&this.j.deviceid&&""!==this.j.deviceid)},Ft.prototype.setUploadUrl=function(t){this.nt=t},Ft.prototype.upload=function(o){return $t(this,void 0,void 0,function(){var n=this;return Bt(this,function(t){if(this.tt())return[2,new Promise(function(e,r){return $t(n,void 0,void 0,function(){var n,i=this;return Bt(this,function(t){switch(t.label){case 0:return(n=function(){return $t(i,void 0,void 0,function(){var n,i,e=this;return Bt(this,function(t){switch(t.label){case 0:this.it=!0,(n=new FormData).append("logs",o),n.append("hello",this.j.appid.toString()),n.append("appid",this.j.appid.toString()),n.append("uin",this.j.userid.toString()),n.append("timestamp",(new Date).getTime().toString()),n.append("token",this.j.token),n.append("deviceid",this.j.deviceid),t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,Kt.post(this.nt,n,this.proxyCtrl)];case 2:if(0!==(i=t.sent()).code)throw new Error("upload logs failed, error=".concat(JSON.stringify(i)));return[3,5];case 3:return i=t.sent(),r(i),[3,5];case 4:return setTimeout(function(){return $t(e,void 0,void 0,function(){return Bt(this,function(t){switch(t.label){case 0:return this.it=!1,[4,this.et.runATask()];case 1:return t.sent(),[2]}})})},100),[7];case 5:return[2]}})})},this.it)?(this.et.pushTask(n,[],function(){e()},function(t){r(t)}),[3,3]):[3,1];case 1:return[4,n()];case 2:t.sent(),e(),t.label=3;case 3:return[2]}})})})];throw new Error("cannot upload logs, please login room before you upload logs.")})})},Ft);function Ft(t,n){this.j=t,this.proxyCtrl=n,this.rt="detaillog-global.zego.im",this.nt="https://".concat(this.rt,"/log/userupload"),this.et=new Wt,this.it=!1}var Ht=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},Zt=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Kt=(Vt.post=function(r,o,u){var t=this;return new Promise(function(i,e){return Ht(t,void 0,void 0,function(){var n;return Zt(this,function(t){try{u?u.startHttpRequest({location:r,body:o,method_no:2,headers:[{name:"Content-Type",val:"multipart/form-data"}],serviceType:2},function(t){200===t.status_code?i(t.body):e("request fail. status="+t.status_code)},function(t){e("request fail. result: "+JSON.stringify(t))}):((n=new XMLHttpRequest).open("POST",r,!0),n.responseType="json",n.send(o),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?i(n.response):e("request fail. status="+n.status))})}catch(t){e(t)}return[2]})})})},Vt);function Vt(){}var N=function(){return(N=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},Qt=(Yt.prototype.build=function(t){var n=N(N({},JSON.parse(t)),{sdkid:this.ot});if(++this.ut%100==0)return(t=JSON.stringify(n)).substring(1,t.length-1);for(i in n)this.st.includes(i)||(n[i]===this.ct[i]?delete n[i]:this.ct[i]=n[i]);var i,e=[];for(i in n)this.st.includes(i)?e.push(n[i]):e.push("".concat(i,":").concat(n[i]));return e.join(",")},Yt.prototype.buildFullMessageLog=function(t){t=JSON.parse(t),t=N(N(N({},this.ct),t),{sdkid:this.ot});return JSON.stringify(t)},Yt);function Yt(t){this.j=t,this.ct={},this.st=["time","action","content","sdkid"],this.ut=0,this.ot=(t=5,crypto.getRandomValues(new Uint8Array(t)).reduce((t,n)=>t+=(n&=63)<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():62<n?"-":"_",""))}var A=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},D=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},tn=(Object.defineProperty(z.prototype,"dbOpened",{get:function(){return this.ft},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,"dbTryOpened",{get:function(){return this.ht},enumerable:!1,configurable:!0}),z.prototype.lt=function(){return A(this,void 0,void 0,function(){var n;return D(this,function(t){switch(t.label){case 0:return[4,this.vt.lines()];case 1:return 153600<(n=t.sent())?[4,this.vt.deleteByCount(n/2)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},z.prototype.makeStorageSpaceUpload=function(){return A(this,void 0,void 0,function(){var r,n=this;return D(this,function(t){return this.dt?(r=function(){return A(n,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,this.vt.lines()];case 1:return 3072<t.sent()?[4,this.wt()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},[2,new Promise(function(i,e){return A(n,void 0,void 0,function(){var n;return D(this,function(t){switch(t.label){case 0:return this.dbOpened?[3,1]:(this.bt.pushTask(r,[],function(){i()},function(t){e(t)}),[3,5]);case 1:return t.trys.push([1,3,,4]),[4,r()];case 2:return t.sent(),[3,4];case 3:return n=t.sent(),e(n),[2];case 4:i(),t.label=5;case 5:return[2]}})})})]):[2]})})},z.prototype.openDB=function(){return A(this,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return this.ht?[2]:(this.ht=!0,[4,this.B.openDB(qt)]);case 1:return t.sent(),this.ft=!0,[4,this.lt()];case 2:return t.sent(),[4,this.bt.runAllTask()];case 3:return t.sent(),[4,this.yt.runATask()];case 4:return t.sent(),this.gt(),[2]}})})},z.prototype.Ot=function(){return this.dt&&z.isEnvSupport()&&!this.ft&&!this.ht},z.prototype.enable=function(){this.dt||(this.dt=!0,this.Ot()&&this.openDB())},z.prototype.saveLog=function(t){this.Ot()&&this.openDB(),this.k.push(this.jt.build(t)),this.gt()},z.prototype.removeLogList=function(n){return A(this,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return 0===n.length?[2]:[4,this.vt.delete(n)];case 1:return t.sent(),[2]}})})},z.prototype.empty=function(){return A(this,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,this.vt.queryList(1)];case 1:return[2,0===t.sent().length]}})})},z.prototype.gt=function(){var n,i=this;this.dt&&this.dbOpened&&!this.xt&&(this.xt=!0,(n=function(){var t=i.k.front();t?t&&i.vt.save(t).then(function(){i.k.pop(),n()}).catch(function(t){i.xt=!1,console.error(t)}):i.xt=!1})())},z.isEnvSupport=function(){return!!(window&&"indexedDB"in window)},z.prototype.St=function(){return A(this,void 0,void 0,function(){var r,o,n,u;return D(this,function(t){switch(t.label){case 0:return[4,this.vt.lines()];case 1:r=t.sent(),o=3145728,n=function(){var n,i,e;return D(this,function(t){switch(t.label){case 0:return[4,u.vt.queryList(Math.min(o,r))];case 1:return(n=t.sent(),r-=o,n.length<=0)?[2,"break"]:(i=new Gt,n.forEach(function(t){i.writeLine(t.log)}),e=i.createZip(),[4,u._t.upload(e)]);case 2:return t.sent(),[4,u.vt.delete(n)];case 3:return t.sent(),[2]}})},u=this,t.label=2;case 2:return 0<r?[5,n()]:[3,4];case 3:return"break"===t.sent()?[3,4]:[3,2];case 4:return[2]}})})},z.prototype.wt=function(){var t=this;return new Promise(function(e,r){return A(t,void 0,void 0,function(){var n,i=this;return D(this,function(t){return n=function(){return A(i,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,this.St()];case 1:return t.sent(),[2]}})})},this.yt.pushTask(n,[],function(){e()},function(t){r(t)},function(){0<i.yt.size()&&i.yt.runATask()}),this.dbOpened&&1===this.yt.size()&&this.yt.runATask(),[2]})})})},z.prototype.Et=function(){var t=this;return new Promise(function(e,r){return A(t,void 0,void 0,function(){var n,i=this;return D(this,function(t){return this.kt=!1,this.Tt=!0,n=function(){return A(i,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return this.Tt=!0,[4,this.St()];case 1:return t.sent(),[2]}})})},this.yt.pushTask(n,[],function(){i.kt=!0,i.Tt=!1,e()},function(t){i.Tt=!1,r(t)},function(){0<i.yt.size()&&i.yt.runATask()}),this.dbOpened&&1===this.yt.size()&&this.yt.runATask(),[2]})})})},z.prototype.setUploadUrl=function(t){this._t.setUploadUrl(t)},z.prototype.startUpload=function(){return A(this,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:if(!this.dt)throw new Error("zip logs upload is not enabled.");if(0!==this.Pt&&performance.now()-this.Pt<6e4&&this.kt||this.Tt)throw new Error("Logs upload failed. Do not report frequently.");return this.Pt=performance.now(),[4,this.Et()];case 1:return t.sent(),[2]}})})},z.prototype.destroy=function(){this.k.clear()},z);function z(t,n){this.j=t,this.proxyCtrl=n,this.B=new zt,this.vt=new Dt(this.B),this.ft=!1,this.ht=!1,this.k=new Jt,this.xt=!1,this.bt=new Wt,this.yt=new Wt,this.dt=!1,this.Pt=0,this.kt=!1,this.Tt=!1,this._t=new Xt(this.j,n),this.jt=new Qt(this.j)}var q=function(){return(q=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},nn=function(t,u,s,c){return new(s=s||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof s?n:new s(function(t){t(n)})).then(e,r)}o((c=c.apply(t,u||[])).next())})},en=function(e,r){var o,u,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},f={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=f&&n[f=0]?0:c;)try{if(o=1,u&&(s=2&n[0]?u.return:n[0]?u.throw||((s=u.return)&&s.call(u),0):u.next)&&!(s=s.call(u,n[1])).done)return s;switch(u=0,(n=s?[2&n[0],s.value]:n)[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,u=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))c.label=n[1];else if(6===n[0]&&c.label<s[1])c.label=s[1],s=n;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],u=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}};Object.defineProperty(I.prototype,"backURL",{get:function(){return this.j.bakURL||""},set:function(t){this.j.bakURL=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"url",{get:function(){return this.j.url||""},set:function(t){this.j.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"logType",{get:function(){return this.j.logType||r.DISABLE},set:function(t){this.j.logType=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"env",{get:function(){return this.j.env},set:function(t){this.j.env=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"appid",{get:function(){return this.j.appid},set:function(t){this.j.appid=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"roomid",{get:function(){return this.j.roomid},set:function(t){this.j.roomid=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"sessionid",{get:function(){return this.j.sessionid},set:function(t){this.j.sessionid=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"userid",{get:function(){return this.j.userid},set:function(t){this.j.userid=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"version",{get:function(){return this.j.version},set:function(t){this.j.version=t},enumerable:!1,configurable:!0}),I.prototype.setLogLevel=function(t){t=u[t];return void 0!==t&&(this.logLevel=t,!0)},I.prototype.setRemoteLogLevel=function(t){t=u[t];return void 0!==t&&(this.logRemoteLevel=t,!0)},I.prototype.setSessionInfo=function(t,n,i,e,r,o){this.appid=t,this.roomid=n,this.sessionid=i,this.userid=e,this.version=o},I.prototype.setTokenInfo=function(t,n){this.j.token=t||"",n&&(this.j.userid=n)},I.prototype.setZipLogConfig=function(t,n){1===t&&this.Nt?this.Nt.enable():0==t&&n&&this.Nt&&(this.Nt.destroy(),this.Nt=null)},I.prototype.setZipLogUploadUrl=function(t){this.Nt&&this.Nt.setUploadUrl(t)},I.prototype.makeZipLogSpaceUpload=function(){return nn(this,void 0,void 0,function(){return en(this,function(t){switch(t.label){case 0:return this.Nt?[4,this.Nt.makeStorageSpaceUpload()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},I.prototype.uploadStorageLog=function(){return nn(this,void 0,void 0,function(){return en(this,function(t){switch(t.label){case 0:return this.Nt?[4,this.Nt.startUpload()]:[3,2];case 1:return t.sent(),[3,3];case 2:throw new Error("cannot use zip log module");case 3:return[2]}})})},I.prototype.report=function(t){t=this.At(u.REPORT,t);this.logLevel!==u.DISABLE&&this.logLevel<=u.REPORT&&!this.isDestroy&&console.debug(t),this.Dt(u.REPORT,t,!0)},I.prototype.debug=function(t,n){var i={},n=("string"==typeof(n=void 0===n?{}:n)?t=Array.from(arguments).join(""):i=n,this.zt(u.DEBUG,t,i));this.logLevel!==u.DISABLE&&this.logLevel<=u.DEBUG&&!this.isDestroy&&console.debug(n),this.qt(u.DEBUG,n)},I.prototype.info=function(t,n){var i={},n=("string"==typeof(n=void 0===n?{}:n)?t=Array.from(arguments).join(""):i=n,this.zt(u.INFO,t,i));this.logLevel!==u.DISABLE&&this.logLevel<=u.INFO&&!this.isDestroy&&console.info(n),this.qt(u.INFO,n)},I.prototype.warn=function(t,n){var i={},n=("string"==typeof(n=void 0===n?{}:n)?t=Array.from(arguments).join(""):i=n,this.zt(u.WARN,t,i));this.logLevel!==u.DISABLE&&this.logLevel<=u.WARN&&!this.isDestroy&&console.warn(n),this.qt(u.WARN,n)},I.prototype.remoteReport=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.zt(u.INFO,t.join(""));this.qt(u.INFO,i)},I.prototype.error=function(t,n){var i={},n=("string"==typeof(n=void 0===n?{}:n)?t=Array.from(arguments).join(""):i=n,this.zt(u.ERROR,t,i));this.logLevel!==u.DISABLE&&this.logLevel<=u.ERROR&&!this.isDestroy&&(console.error(n),this.env%2===o.BROWSER&&window?this.stateCenter.debug&&window.alert(t.substr(t.indexOf(" ")+1,4500)):(this.env,o.WEIXINMINI)),this.qt(u.ERROR,n)},I.prototype.qt=function(t,n){this.logRemoteLevel!==u.DISABLE&&this.logRemoteLevel<=t&&(this.Dt(t,n),this.Nt)&&this.Nt.saveLog(n)},I.prototype.setLogServer=function(t,n){if(this.isDestroy)return!1;this.url!==t&&(this.logConnected=!1);try{return t.startsWith("wss:")?(this.logType=r.WEBSOCKET,this.It.openWebSocketLogServer(t,!0)):t.startsWith("https:")?(this.logType=r.HTTPS,this.Rt(t,n)):this.logType=r.DISABLE,!0}catch(t){return this.error(JSON.stringify(t)),!1}},I.prototype.Jt=function(){this.logType==r.WEBSOCKET?this.Mt():this.logType==r.HTTPS&&(this.Ct(),this.Lt()),this.logType=r.DISABLE},I.prototype.Mt=function(){this.It.stopWebSocketServer()},I.prototype.Rt=function(t,n){var i,e=this;this.url=t,null!=(i=null==n?void 0:n.bakURL)&&i.startsWith("https://")&&(this.backURL=n.bakURL),t&&(this.Lt(),this.logUploadTimer||(this.logUploadTimer=setInterval(function(){e.Ct()},this.logUploadInterval)))},I.prototype.Lt=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},I.prototype.Dt=function(n,i,e){return void 0===e&&(e=!1),nn(this,void 0,void 0,function(){return en(this,function(t){if(!this.isDestroy)if(this.logType==r.WEBSOCKET)this.Wt(n,i);else if(this.logType==r.HTTPS)this.Gt(n,i,e);else if(this.logLevel!==u.DISABLE&&this.logLevel<=n){if(4e3<i.length)return[2];for(this.Ut.push(i);this.Ut.size()>this.$t;)this.Ut.pop()}return[2]})})},I.prototype.clearCache=function(){0!==this.Ut.size()&&this.It.clearLogCacheAndUpload()},I.prototype.Wt=function(r,n){return nn(this,void 0,void 0,function(){var i,e=this;return en(this,function(t){return"string"==typeof n&&4e3<n.length?function(t,n){void 0===n&&(n=2e3);for(var i=[],e=0;e<t.length;)i.push(t.substring(e,e+n)),e+=n;return i}((i=JSON.parse(n)).content,3e3).forEach(function(t,n){3<n||(i.content="s".concat(n+1,": ").concat(t),e.Wt(r,JSON.stringify(i)))}):this.j.useStrategy&&this.env==o.BROWSER&&this.It.addRemoteWsLog(n),[2]})})},I.prototype.Gt=function(t,n,i){this.Ut.push(n),(this.Ut.size()>=this.$t||!0===i)&&this.Ct()},I.prototype.zt=function(t,n,i){void 0===i&&(i={});var e=U(),n=[n.substr(0,n.indexOf(" "))||n,n.substr(n.indexOf(" ")+1,8e3)||n],r=n[0],n=n[1],i=q(q({},i),{time:e,level:t,action:r,content:n,appid:this.appid,roomid:this.roomid||void 0,userid:this.userid,sessionid:this.sessionid||void 0});return JSON.stringify(i)},I.prototype.At=function(t,n){var i=U(),e="",e=this.env%2===o.BROWSER?"rtc":"ali";return n=q(q({},n),{time:i,level:t,console:e,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+n.event_time+"_"+n.seq}),JSON.stringify(n)},I.prototype.Ct=function(){0!=this.Ut.size()&&(this.env%2===o.BROWSER?this.Bt():this.SendHttpsLogWeChatMini())},I.prototype.Bt=function(){var n=this,t=this.Ut.buffer.join("\n"),i=this.Ut.buffer,e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState){if(200==e.status){if(n.logConnected=!0,0==e.responseText.length)return;try{var t=JSON.parse(e.responseText).interval;"number"==typeof t&&n.logUploadInterval!==t&&(n.timeInterval=t,n.Rt(n.url))}catch(t){n.Ut.buffer=i.concat(n.Ut.buffer),console.log("send result failed "+t)}}else n.Ut.buffer=i.concat(n.Ut.buffer);i=null}},e.open("POST",this.url,!0),0==this.env?e.send(t):1==this.env&&(e.setRequestHeader("content-type","application/json"),e.send(JSON.stringify({user_id:this.userid,log:t}))),this.Ut.buffer=[]},I.prototype.SendHttpsLogWeChatMini=function(){},I.prototype.destroy=function(){this.Jt(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),J.instance=void 0,this.It.destroy(),this.Nt&&this.Nt.destroy(),this.url="",this.isDestroy=!0},I.logVersion="1.4.10";var rn=I;function I(t,n){var i=this;this.proxyCtrl=n,this.logLevel=u.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.$t=8192,this.q={debug:this.debug.bind(this),info:this.info.bind(this),warn:this.warn.bind(this),error:this.error.bind(this)},this.logConnected=!1,this.stateCenter=J.getInstance(),this.j=new _t,this.j.env=t,this.Ut=new Pt(this.j,this.$t),this.It=new nt(this.Ut,this.j,this.q,this.proxyCtrl),this.It.onSocketConnect=function(){i.logConnected=!0},this.env==o.BROWSER&&tn.isEnvSupport()&&(this.Nt=new tn(this.j,this.proxyCtrl))}}],s={},o.m=u,o.c=s,o.d=function(t,n,i){o.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"Xt",{value:!0})},o.t=function(n,t){if(1&t&&(n=o(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.Xt)return n;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var e in n)o.d(i,e,function(t){return n[t]}.bind(null,e));return i},o.n=function(t){var n=t&&t.Xt?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=4);function o(t){var n;return(s[t]||(n=s[t]={i:t,l:!1,exports:{}},u[t].call(n.exports,n,n.exports,o),n.l=!0,n)).exports}var u,s});