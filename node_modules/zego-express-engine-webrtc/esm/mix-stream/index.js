!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("long"),require("protobufjs/minimal"));else if("function"==typeof define&&define.amd)define(["long","protobufjs/minimal"],t);else{var r="object"==typeof exports?t(require("long"),require("protobufjs/minimal")):t(e.long,e["protobufjs/minimal"]);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,(function(e,t){return function(){"use strict";var r={3091:function(e,t,r){var n;!function(e){e[e.PortraitSegmentation=0]="PortraitSegmentation"}(n||(n={}))},2593:function(e,t,r){var n,o,i;!function(e){e[e.Song=0]="Song",e[e.Accompaniment=1]="Accompaniment",e[e.AccompanimentClip=2]="AccompanimentClip",e[e.AccompanimentSegment=3]="AccompanimentSegment"}(n||(n={})),function(e){e[e.Count=0]="Count",e[e.User=1]="User",e[e.Room=2]="Room",e[e.Master=3]="Master"}(o||(o={})),function(e){e[e.VendorDefault=0]="VendorDefault",e[e.Vendor1=1]="Vendor1",e[e.Vendor2=2]="Vendor2",e[e.Vendor3=4]="Vendor3"}(i||(i={}))},9022:function(e,t,r){r.d(t,{Xk:function(){return d},zN:function(){return c}});var n,o,i,s,a,u,d,m,c,l,f,_;r(8899),r(2593),r(3091),r(166);!function(e){e[e.Off=0]="Off",e[e.On=1]="On"}(n||(n={})),function(e){e[e.PortraitSegmentation=0]="PortraitSegmentation"}(o||(o={})),function(e){e[e.ZegoGeoFenceTypeNone=0]="ZegoGeoFenceTypeNone",e[e.ZegoGeoFenceTypeInclude=1]="ZegoGeoFenceTypeInclude",e[e.ZegoGeoFenceTypeExclude=2]="ZegoGeoFenceTypeExclude"}(i||(i={})),function(e){e[e.AspectFill=0]="AspectFill",e[e.AspectFit=1]="AspectFit"}(s||(s={})),function(e){e[e.ZegoFontTypeSourceHanSans=0]="ZegoFontTypeSourceHanSans",e[e.ZegoFontTypeAlibabaSans=1]="ZegoFontTypeAlibabaSans",e[e.ZegoFontTypePangMenZhengDaoTitle=2]="ZegoFontTypePangMenZhengDaoTitle",e[e.ZegoFontTypeHappyZcool=3]="ZegoFontTypeHappyZcool"}(a||(a={})),function(e){e[e.ZegoDefined=0]="ZegoDefined",e[e.UserUnregister=1]="UserUnregister"}(u||(u={})),function(e){e[e.ZegoAudioCodecIDNormal=1]="ZegoAudioCodecIDNormal",e[e.ZegoAudioCodecIDNormal2=2]="ZegoAudioCodecIDNormal2",e[e.ZegoAudioCodecIDLow3=6]="ZegoAudioCodecIDLow3"}(d||(d={})),function(e){e[e.ZegoAudioMixModeRaw=0]="ZegoAudioMixModeRaw",e[e.ZegoAudioMixModeFocused=1]="ZegoAudioMixModeFocused"}(m||(m={})),function(e){e[e.ZegoEncodeProfileDefault=0]="ZegoEncodeProfileDefault",e[e.ZegoEncodeProfileBaseline=1]="ZegoEncodeProfileBaseline",e[e.ZegoEncodeProfileMain=2]="ZegoEncodeProfileMain",e[e.ZegoEncodeProfileHigh=3]="ZegoEncodeProfileHigh"}(c||(c={})),function(e){e[e.TrafficControlFocusOnLocalOnly=0]="TrafficControlFocusOnLocalOnly",e[e.TrafficControlFocusOnRemote=1]="TrafficControlFocusOnRemote"}(l||(l={})),function(e){e[e.Allow=0]="Allow",e[e.NotAllow=1]="NotAllow"}(f||(f={})),function(e){e[e.video=0]="video",e[e.audio=1]="audio",e[e.videoAndAudio=2]="videoAndAudio"}(_||(_={}))},8899:function(e,t,r){var n,o,i,s;!function(e){e[e.Off=0]="Off",e[e.TurningOn=1]="TurningOn",e[e.On=2]="On"}(n||(n={})),function(e){e[e.World=0]="World",e[e.Team=1]="Team",e[e.SecretTeam=2]="SecretTeam"}(o||(o={})),function(e){e[e.All=0]="All",e[e.World=1]="World",e[e.Team=2]="Team"}(i||(i={})),function(e){e[e.All=0]="All",e[e.World=1]="World",e[e.Team=2]="Team"}(s||(s={}))},166:function(e,t,r){var n,o,i,s;!function(e){e[e.NONE=0]="NONE",e[e.MEN_TO_CHILD=1]="MEN_TO_CHILD",e[e.MEN_TO_WOMEN=2]="MEN_TO_WOMEN",e[e.WOMEN_TO_CHILD=3]="WOMEN_TO_CHILD",e[e.WOMEN_TO_MEN=4]="WOMEN_TO_MEN",e[e.FOREIGNER=5]="FOREIGNER",e[e.OPTIMUS_PRIME=6]="OPTIMUS_PRIME",e[e.ANDROID=7]="ANDROID",e[e.ETHEREAL=8]="ETHEREAL",e[e.MALE_MAGNETIC=9]="MALE_MAGNETIC",e[e.FEMALE_FRESH=10]="FEMALE_FRESH",e[e.MAJOR_C=11]="MAJOR_C",e[e.MINOR_A=12]="MINOR_A",e[e.HARMONIC_MINOR=13]="HARMONIC_MINOR",e[e.FEMALE_ENERGETIC=14]="FEMALE_ENERGETIC",e[e.RICHNESS=15]="RICHNESS",e[e.MUFFLED=16]="MUFFLED",e[e.ROUNDNESS=17]="ROUNDNESS",e[e.FALSETTO=18]="FALSETTO",e[e.FULLNESS=19]="FULLNESS",e[e.CLEAR=20]="CLEAR",e[e.HIGHLY_RESONANT=21]="HIGHLY_RESONANT",e[e.LOUD_CLEAR=22]="LOUD_CLEAR"}(n||(n={})),function(e){e[e.None=0]="None",e[e.SoftRoom=1]="SoftRoom",e[e.LargeRoom=2]="LargeRoom",e[e.ConcertHall=3]="ConcertHall",e[e.Valley=4]="Valley",e[e.RecordingStudio=5]="RecordingStudio",e[e.Basement=6]="Basement",e[e.KTV=7]="KTV",e[e.Popular=8]="Popular",e[e.Rock=9]="Rock",e[e.VocalConcert=10]="VocalConcert",e[e.GramoPhone=11]="GramoPhone",e[e.EnhancedKTV=12]="EnhancedKTV"}(o||(o={})),function(e){e[e.None=0]="None",e[e.Local=1]="Local",e[e.Publish=2]="Publish",e[e.All=3]="All"}(i||(i={})),function(e){e[e.AI=0]="AI",e[e.AIBalanced=1]="AIBalanced"}(s||(s={}))},4908:function(e,t,r){r.d(t,{oq:function(){return o}});r(8627),r(5095);var n="/sdk/init",o={event:n}},5095:function(e,t,r){r.d(t,{Gq:function(){return n},Tr:function(){return s},tK:function(){return o},yS:function(){return a},yp:function(){return i}});var n=function(e){return e},o=function(e){return e},i=function(e){return e},s=function(e){return e},a=function(e){return e}},8627:function(e,t,r){r.d(t,{$wo:function(){return P},Arx:function(){return Ee},B3d:function(){return ge},Be2:function(){return ne},FB3:function(){return Z},HCP:function(){return H},HO9:function(){return R},I4J:function(){return Ne},I7C:function(){return te},J79:function(){return u},JDv:function(){return ie},JSm:function(){return oe},L8E:function(){return $},LLz:function(){return S},MK1:function(){return ce},MrD:function(){return Q},MuX:function(){return Ce},NCg:function(){return Le},OdW:function(){return ze},OrZ:function(){return D},Oy0:function(){return f},PA0:function(){return d},PTE:function(){return O},Q3v:function(){return se},Q9p:function(){return l},Qo5:function(){return v},RBR:function(){return ue},RZs:function(){return Ae},RfS:function(){return G},S4u:function(){return i},S5f:function(){return m},SB8:function(){return be},SRE:function(){return V},SmZ:function(){return z},Srw:function(){return p},Tij:function(){return Me},VU9:function(){return k},WP4:function(){return K},XHx:function(){return Re},Xxx:function(){return M},YDn:function(){return pe},ZEp:function(){return c},ZpF:function(){return N},Zws:function(){return he},_68:function(){return U},_HD:function(){return _},aUw:function(){return I},aa2:function(){return w},ann:function(){return me},b1q:function(){return Te},ckD:function(){return ke},clM:function(){return s},d49:function(){return a},dXc:function(){return Se},dg1:function(){return y},dqB:function(){return le},ekj:function(){return xe},f43:function(){return j},fzq:function(){return F},g9p:function(){return x},gHA:function(){return fe},gSF:function(){return b},hYx:function(){return ye},hje:function(){return ve},iei:function(){return L},jZ$:function(){return q},kOd:function(){return B},kbF:function(){return W},lgu:function(){return Ie},m6U:function(){return ee},mrK:function(){return Y},pWJ:function(){return De},qvY:function(){return ae},sJH:function(){return C},sVF:function(){return h},s_m:function(){return A},t85:function(){return X},ulL:function(){return g},wxm:function(){return _e},xU2:function(){return J},xbZ:function(){return de},xfZ:function(){return E},yK:function(){return T},zML:function(){return Oe},zs3:function(){return re}});var n=r(8866),o="the user cancels the stream request.",i={code:1000002,message:"not login room"},s={code:1000014,message:"stream ID is too long"},a={code:1000015,message:"streamID is empty"},u={code:1000016,message:"stream ID contains illegal characters"},d={code:1000017,message:n.Rl},m={code:1000018,message:n.qC},c={code:1100001,message:n.dO},l={code:1100002,message:"network timeout."},f={code:1100999,message:"unknown server error"},_={code:1101005,message:"signal hb fail"},v={code:1002011,message:"room ID is empty"},g={code:1002012,message:"room ID contains illegal characters"},p={code:1002013,message:"room ID is too long"},h={code:1002014,msg:n.fT},b={code:1102017,message:"dispatch error"},x={code:1102018,message:"token expired"},R={code:1102021,message:"biz channel error."},E={code:1102022,message:"dispatch request timeout"},I={code:1102024,message:"invalid channel"},M={code:1003025,message:"stream is forbided by media server"},O={code:1003050,message:"extra info of publishing stream is null"},S={code:1103001,message:n.dO},D={code:1103002,message:"browser do not support"},T={code:1103010,message:"screen fail"},A={code:1103011,message:"enumerate devices fail"},C={code:1103019,message:"publish streams auth fail"},N={code:1103021,message:"session request fail"},z={code:1103022,message:"create offer error"},k={code:1103023,message:"setLocalDescription error"},y={code:1103024,message:"mediaDesc error"},L={code:1103025,message:"other side offer error"},U={code:1103026,message:"candidate error"},q={code:1103027,message:"server session closed"},w={code:1103028,message:"ice connection error"},P={code:1103030,message:"negotiation timeout"},X={code:1103042,message:"screen canceled"},$={code:1103043,message:"screen not support"},F={code:1103044,message:n.aw},j={code:1103099,message:"stream is not capturing"},G={code:1103049,message:"repeated pull same stream"},H={code:1103050,message:"websocket disconnected"},V={code:1103051,message:"publisher retry timeout"},Z={code:1103053,message:"https is required"},J={code:1103055,message:n.Wk},W={code:1103056,message:"publish is publishing"},B={code:1103058,message:"client ip changed"},K={code:1103059,message:"ttl over time"},Q={code:1103060,message:"session request timeout"},Y={code:1103061,message:"get media fail"},ee={code:1103062,message:"update stream info fail"},te={code:1103063,message:"publish target no response"},re={code:1103064,message:"get device not allowed"},ne={code:1103065,message:"device is not readable"},oe={code:1103066,message:"device does not meet constraints"},ie={code:1103067,message:"update sdp time out"},se={code:1103068,message:"update sdp fail"},ae={code:1103073,message:"video effect is starting, please operate after video effect is started"},ue={code:1103078,message:"publish stream poor and net probe poor"},de={code:1103089,message:o},me={code:1104001,message:"input parm error"},ce={code:1104021,message:"session request fail"},le={code:1104022,message:"create offer error"},fe={code:1104023,message:"setLocalDescription error"},_e={code:1104024,message:"mediaDesc error"},ve={code:1104025,message:"other side offer error"},ge={code:1104026,message:"candidate error"},pe={code:1104027,message:"server session closed"},he={code:1104028,message:"ice connection error"},be={code:1104029,message:"websocket disconnected"},xe={code:1104030,message:"negotiation timeout"},Re={code:1104031,message:"player retry timeout"},Ee={code:1104032,message:"player is playing"},Ie={code:1104033,message:"client ip changed"},Me={code:1104034,message:"ttl is over time"},Oe={code:1104035,message:"reset session push"},Se={code:1104036,message:"session request timeout"},De={code:1104037,message:"probe time out"},Te={code:1104038,message:"resource mode is not supported"},Ae={code:1104039,message:"play stream not found"},Ce={code:1104041,message:"stream quality poor and net probe poor"},Ne={code:1104042,message:o},ze={code:1104043,message:"mini sdp error"},ke={code:1104045,message:"play streams is out limit"},ye={code:1104046,message:"play streams auth fail"},Le={code:1103100,message:"background process is start, but not subscribe yet"}},8866:function(e,t,r){r.d(t,{M$:function(){return i},Rl:function(){return g},Wk:function(){return v},aw:function(){return c},dO:function(){return l},fT:function(){return d},gU:function(){return a},h2:function(){return _},jy:function(){return s},l3:function(){return o},pt:function(){return m},qC:function(){return f},zQ:function(){return u}});r(8627);var n=r(4872),o=(r(6994),Promise);function i(e){for(var t in e)(0,n.w)(e[t])?i(e[t]):e.hasOwnProperty(t)||((0,n.Cs)(e[t])&&(e[t]=0),(0,n.QP)(e[t])&&(e[t]=""))}function s(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)}function a(e){return!!(e.startsWith("rtmp://")||e.startsWith("avertp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))}function u(e,t){return 0==t?(0,n.Cs)(e)&&e%1==0&&e>=0:(0,n.Cs)(e)&&e%1==0&&e>0}var d="room not exist",m="device is not found",c="stream is not from zego",l="input param error",f="local stream wrong",_="no preview",v="publish stream no found",g="network is broken"},4872:function(e,t,r){function n(e){return"number"==typeof e}function o(e){return"string"==typeof e}function i(e){return"boolean"==typeof e}function s(e){return void 0===e}function a(e){return null!==e&&e instanceof Object}function u(e){return"function"==typeof e}function d(e){return e instanceof Uint8Array}function m(e){return(e.startsWith("preset-id://")||e.startsWith("http")||e.startsWith("https"))&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".png"))}r.d(t,{$C:function(){return m},Cs:function(){return n},G0:function(){return d},JO:function(){return u},QP:function(){return o},TE:function(){return s},dd:function(){return i},w:function(){return a}})},423:function(e,t,r){var n=r(3788);const o=r(6994);n.util.Long=o,n.util.Long.fromBits=n.util.Long?n.util.Long.fromBits:function(){return 0};for(var i=n.roots,s=n.types?n.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},a=n.types?n.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},u=Object.keys(s),d={$:function(e){return d[e]?d[e].call(this):i[e].decode?i[e].decode(this,this.uint32()):d.$.call(this,"int32")}},m={$:function(e,t,r){var n=s[e];return void 0===n?i[e].encode?(this.uint32(r<<3|2).fork(),i[e].encode(t,this).ldelim()):m.$.call(this,"int32",t,r):m[e].call(this.uint32(r<<3|n),t)}},c=0;c<u.length;c++)d[u[c]]=n.Reader.prototype[u[c]],m[u[c]]=n.Writer.prototype[u[c]];!function e(t,r,o,u){for(var c=0,l=Object.keys(t);c<l.length;c++){var f=l[c];if(t[f].$m&&Object.keys(t[f].$m).every((function(e){return Number(e)}))){if(o[f])throw Error(`nested type ${o}.${f} has already exist`);o[f]=function(t,o){function u(e){for(var r in t){var n=t[r];"{"===n[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[])}if(e)for(var o=Object.keys(e),i=0;i<o.length;++i)null!=e[o[i]]&&(this[o[i]]=e[o[i]])}var c={};for(var l in t){var f=t[l],_=f[1];"{"===_.charAt(0)?(u.prototype[f[0]]=n.util.emptyObject,c[_]={$m:_.substring(1).split(",").map((function(e,t){return[`$${t+1}`,e,null]})).reduce((function(e,t,r){return e[r+1]=t,e}),{})}):u.prototype[f[0]]="["===_.charAt(0)||"<"===_.charAt(0)?n.util.emptyArray:"bytes"===_?n.util.newBuffer([]):f[2]&&f[2].hasOwnProperty("low")&&f[2].hasOwnProperty("high")?n.util.Long.fromBits(f[2].low,f[2].high,f[2].unsigned):f[2]}return u.create=function(e){return new u(e)},u.decode=function(e,r){e instanceof n.Reader||(e=n.Reader.create(e));for(var o=void 0===r?e.len:e.pos+r,s=new u;e.pos<o;){var m=e.uint32(),c=m>>>3;if(c>0&&t[c]){var l=t[c][0],f=t[c][1];if("{"===f.charAt(0)){s[l]===n.util.emptyObject&&(s[l]={});var _=u.$namespace[f].decode(e,e.uint32());s[l][_.$1]=_.$2}else if("["===f.charAt(0)||"<"===f.charAt(0)){f=f.substring(1),s[l]&&s[l].length||(s[l]=[]);if(void 0!==a[f=!d[f]&&!i[f].decode?"int32":f]&&2==(7&m))for(var v=e.uint32()+e.pos;e.pos<v;)s[l].push(d.$.call(e,f));else s[l].push(d.$.call(e,f))}else s[l]=d.$.call(e,f)}else e.skipType(7&m)}return s},u.encode=function(e,r){for(var o in r||(r=n.Writer.create()),t){var d=t[o][0],c=t[o][1];if("{"===c.charAt(0)){if(null!=e[d]&&e.hasOwnProperty(d))for(var l=0,f=Object.keys(e[d]);l<f.length;++l)r.uint32(o<<3|2).fork(),u.$namespace[c].encode({$1:f[l],$2:e[d][f[l]]},r).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var _="<"===c.charAt(0);c=c.substring(1);var v=e[d];if(null!=v&&v.length){if(c=void 0===s[c]&&!i[c].encode?"int32":c,_&&void 0!==a[c]){r.uint32(o<<3|2).fork();for(l=0;l<v.length;l++)m[c].call(r,v[l]);r.ldelim()}else for(l=0;l<v.length;l++)m.$.call(r,c,v[l],o)}}else null!=e[d]&&e.hasOwnProperty(d)&&m.$.call(r,c,e[d],o)}return r},Object.keys(c).length&&(u.$namespace=e(c,r+"."+o,u.$namespace||{},!0)),u}(t[f].$m,f)}else t[f].$s?o[f]=function(e,t){function o(e,t,r){n.rpc.Service.call(this,e,t,r)}return(o.prototype=Object.create(n.rpc.Service.prototype)).constructor=o,o.create=function(e,t,r){return new o(e,t,r)},Object.keys(e).forEach((function(n){var s=e[n];function a(e,t){return this.rpcCall(a,i[s[0]],i[s[1]],e,t)}Object.defineProperty(a,"name",{value:n}),Object.defineProperty(a,"path",{value:`${r}.${t}`}),o.prototype[n]=a})),o}(t[f].$s,f):t[f].$e&&Object.values(t[f].$e).every((function(e){return Number(e)===e}))&&(o[f]=function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[r[t[n]]=e[t[n]]]=t[n];return r}(t[f].$e));o[f]&&!u&&(i[`${r}.${f}`]=o[f]),delete t[f].$m,delete t[f].$s,delete t[f].$e,o[f]=e(t[f],r?`${r}.${f}`:f,o[f]||{})}return o}({mixstream:{proto_mixstream:{AutoRoomMixOutputStream:{$m:{1:["stream_out_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["audio_channel_cnt","int32",0]}},AutoRoomMixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],3:["mix_source","string",""],4:["room_id","string",""],5:["task_id","string",""],6:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],7:["output_stream","<mixstream.proto_mixstream.AutoRoomMixOutputStream",null],8:["extra_params","<mixstream.proto_mixstream.MixAdvanceConfig",null],9:["has_recv_buffer_level","bool",!1],10:["recv_buffer_level","sint32",0]}},AutoRoomMixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},AutoRoomMixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""]}},AutoRoomMixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},GetMixStreamStatusRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},GetMixStreamStatusResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["push_url","<mixstream.proto_mixstream.PushUrl",null],4:["version","int32",0],5:["task_id","string",""]}},MixAdvanceConfig:{$m:{1:["key","string",""],2:["value","string",""]}},MixImage:{$m:{1:["url","string",""],2:["display_mode","int32",0]}},MixInputStream:{$m:{1:["stream_input_common","mixstream.proto_mixstream.MixInputStreamCommon",null],2:["volume","int32",0],3:["audio_focus","int32",0],4:["audio_h_angle","int32",0],5:["render_mode","int32",0],6:["corner_radius","uint32",0],7:["label","mixstream.proto_mixstream.MixLabel",null],8:["image","mixstream.proto_mixstream.MixImage",null]}},MixInputStreamCommon:{$m:{1:["stream_id","string",""],2:["sound_level_id","uint32",0],3:["content_control","int32",0],4:["layer_rect","mixstream.proto_mixstream.MixRect",null],5:["stream_url","string",""]}},MixLabel:{$m:{1:["text","string",""],2:["text_left","int32",0],3:["text_top","int32",0],4:["font","mixstream.proto_mixstream.MixLableFont",null]}},MixLableFont:{$m:{1:["font_type","int32",0],2:["font_size","int32",0],3:["font_color","int32",0],4:["font_transparency","int32",0],5:["font_border_color","sint32",0]}},MixOutputStream:{$m:{1:["output_stream_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["video_enc_id","int32",0],3:["video_encode_latency","int32",0],4:["video_encode_profile","int32",0],5:["low_bitrate_hd","int32",0]}},MixOutputStreamCommon:{$m:{1:["is_url","int32",0],2:["target","string",""],3:["video_fps","int32",0],4:["rate_control_mode","int32",0],5:["video_bitrate","int32",0],6:["video_width","int32",0],7:["video_height","int32",0],8:["output_quality","int32",0],9:["audio_bitrate","int32",0],10:["audio_enc_id","int32",0]}},MixRect:{$m:{1:["top","int32",0],2:["left","int32",0],3:["bottom","int32",0],4:["right","int32",0],5:["layer","int32",0]}},MixStartReplyData:{$m:{1:["request_id","string",""],2:["play_infos","<mixstream.proto_mixstream.PlayInfo",null]}},MixStreamCommon:{$m:{1:["user_data","string",""],2:["output_bg_color","int32",0],3:["output_bg_image","string",""],4:["with_sound_level","int32",0],5:["single_stream_pass_through","int32",0],6:["alignment_type","int32",0]}},MixstreamServerCommonResponse:{$m:{1:["code","uint32",0],2:["message","string",""]}},MixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_protocol_version","int32",0],3:["task_id","string",""],4:["room_id","string",""],5:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],6:["audio_channel_cnt","int32",0],7:["audio_mix_mode","int32",0],8:["recv_buffer_level","sint32",0],9:["input_stream","<mixstream.proto_mixstream.MixInputStream",null],10:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],11:["advance_config","<mixstream.proto_mixstream.MixAdvanceConfig",null],12:["output_stream","<mixstream.proto_mixstream.MixOutputStream",null],13:["white_board","mixstream.proto_mixstream.MixWhiteBoard",null],14:["timestamp","int64",{low:0,high:0,unsigned:!1}],15:["check_image_mode","int32",0]}},MixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["data","mixstream.proto_mixstream.MixStartReplyData",null],4:["error_streamid_list","<string",null]}},MixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""],4:["is_url","int32",0],5:["target","string",""],6:["timestamp","int64",{low:0,high:0,unsigned:!1}]}},MixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},MixStreamTaskHbRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},MixStreamTaskHbResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["status","uint32",0],4:["hb_interval","uint32",0]}},MixWaterMark:{$m:{1:["image","string",""],2:["layout_rect","mixstream.proto_mixstream.MixRect",null]}},MixWhiteBoard:{$m:{1:["whiteboard_id","uint64",{low:0,high:0,unsigned:!0}],2:["horizontal_ratio","int32",0],3:["vertical_ratio","int32",0],4:["is_ppt_animation","int32",0],5:["layout_rect","mixstream.proto_mixstream.MixRect",null],6:["background_color","int32",0]}},PlayInfo:{$m:{1:["stream_alias","string",""],2:["rtmp_url","string",""],3:["hls_url","string",""],4:["hdl_url","string",""]}},PushUrl:{$m:{1:["status","int32",0],2:["url","string",""],3:["mod_time","int64",{low:0,high:0,unsigned:!1}],4:["reason","int32",0]}}}}},"",i,!1),t.A=i.mixstream},6994:function(t){t.exports=e},3788:function(e){e.exports=t}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,o),i.exports}o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.r(i),o.d(i,{MixStream:function(){return w}});var s,a,u,d=o(8627),m={NOT_LOGIN:d.S4u,INPUT_PARAM:d.ZEp,TIMEOUT:d.Q9p,MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_INPUT_LABEL_TOO_LONG:{code:1005028,message:"Input stream label text is too long"},MIXER_OUTPUT_TARGET_TOO_LONG:{code:1005029,message:"Output stream target is too long"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_INPUT_IMAGE_URL_TOO_LONG:{code:1005034,message:"Input stream image url too long"},MIXER_INPUT_IMAGE_FORMAT_WRONG:{code:1005035,message:"Input stream image format wrong"},MIXER_INPUT_IMAGE_GET_FAIL:{code:1005036,message:"Input stream image get fail"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}},c=o(9022);s=o(423).A.proto_mixstream,a=o(3788),u=o(6994),a.util.Long=u,a.configure();var l,f=function(){function e(){}return e.prototype.encodeMixStreamStartReq=function(e){var t=s.MixStreamStartRequest.create(e);return s.MixStreamStartRequest.encode(t).finish()},e.prototype.decodeMixStreamStartRsp=function(e){return s.MixStreamStartResponse.decode(e)},e.prototype.encodeMixStreamStopReq=function(e){var t=s.MixStreamStopRequest.create(e);return s.MixStreamStopRequest.encode(t).finish()},e.prototype.decodeMixStreamStopRsp=function(e){return s.MixStreamStopResponse.decode(e)},e.prototype.encodeGetMixStreamStatusReq=function(e){var t=s.GetMixStreamStatusRequest.create(e);return s.GetMixStreamStatusRequest.encode(t).finish()},e.prototype.decodeGetMixStreamStatusRsp=function(e){return s.GetMixStreamStatusResponse.decode(e)},e.prototype.encodeAutoRoomMixStreamStartReq=function(e){var t=s.AutoRoomMixStreamStartRequest.create(e);return s.AutoRoomMixStreamStartRequest.encode(t).finish()},e.prototype.decodeAutoRoomMixStreamStartRsp=function(e){return s.AutoRoomMixStreamStartResponse.decode(e)},e.prototype.encodeAutoRoomMixStreamStopReq=function(e){var t=s.AutoRoomMixStreamStopRequest.create(e);return s.AutoRoomMixStreamStopRequest.encode(t).finish()},e.prototype.decodeAutoRoomMixStreamStopRsp=function(e){return s.AutoRoomMixStreamStopResponse.decode(e)},e.prototype.encodeMixStreamTaskHbReq=function(e){var t=s.MixStreamTaskHbRequest.create(e);return s.MixStreamTaskHbRequest.encode(t).finish()},e.prototype.decodeMixStreamTaskHbRsp=function(e){return s.MixStreamTaskHbResponse.decode(e)},e}(),_=o(5095),v={event:"/mix/start_mix",error:{t:m.INPUT_PARAM,i:m.MIXER_TASK_ID_NULL,u:m.MIXER_TASK_ID_TOO_LONG,m:m.MIXER_TASK_ID_INVALID_CHARACTER,l:m.MIXER_INPUTLIST_NULL,_:m.MIXER_OUTPUTLIST_NULL,v:m.MIXER_OUTPUT_TARGET_INVALID,p:m.MIXER_NO_OUTPUT_TARGET,R:m.MIXER_OUTPUT_TARGET_TOO_LONG,O:m.MIXER_START_REQUEST_ERROR,S:m.MIXER_INNER_ERROR,D:m.MIXER_INPUT_LABEL_TOO_LONG,T:m.MIXER_INPUT_IMAGE_URL_TOO_LONG,C:m.MIXER_INPUT_IMAGE_FORMAT_WRONG,N:m.MIXER_WATERMARK_URL_INVALID,k:m.MIXER_WATERMARK_PARAMETERS_ERROR,U:m.NOT_LOGIN},mix_stream_conf:_.Gq,stop_reason:_.tK},g={event:"/mix/stop_mix",error:{t:m.INPUT_PARAM,i:m.MIXER_TASK_ID_NULL,O:m.MIXER_STOP_REQUEST_ERROR,S:m.MIXER_INNER_ERROR,U:m.NOT_LOGIN}},p={event:"/mix/config_mix",error:{t:m.INPUT_PARAM,q:m.MIXER_VIDEO_CONFIG_INVALID,P:m.MIXER_BACKGROUND_IMAGE_URL_INVALID,U:m.NOT_LOGIN},mix_params:_.Gq},h="/automix/start",b="/automix/stop",x=o(4872),R=o(8866),E=o(4908),I=function(){return I=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},I.apply(this,arguments)},M=256,O=1024,S=1e4;l=o(6994);var D,T=["NO_RELAY","RELAYING","RELAY_REQUESTING","NO_RELAY"],A={0:"NONE",8:"SERVER_ERROR",9:"HANDSHAKE_FAILED",10:"ACCESS_POINT_ERROR",11:"CREATE_STREAM_FAILED",12:"BAD_NAME",13:"CDN_SERVER_DISCONNECTED",14:"DISCONNECTED",1214:"ALL_INPUT_STREAM_CLOSED",1215:"ALL_INPUT_STREAM_NO_DATA",1230:"SERVER_INTERNAL_ERROR"};function C(e,t){var r,n,o,i,s="",a=m;return t.errorCode<2e9&&t.errorCode>1e9?(o={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",141:"MIXER_INPUT_IMAGE_FORMAT_WRONG",142:"MIXER_INPUT_IMAGE_GET_FAIL",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",179:"MIXER_INPUT_LABEL_TOO_LONG",190:"MIXER_START_REQUEST_ERROR"},i="MIXER_INNER_ERROR",(n=t.errorCode-S)>1e9&&o[n-1e9]&&(i=o[n-1e9]),r=a[s=i]):t.errorCode<1e6&&(r=e.decodeServerError(t.errorCode,t.extendedData),s=e.getLiveRoomError(t.errorCode)),{reportErr:r,actualError:a[s]}}!function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(D||(D={}));var N,z={VIDEO:0,AUDIO:1,VIDEO_ONLY:2},k={"H.264":0,"H.265":3};function y(e){var t=N.AUDIO_ENC_HE_AAC;switch(e){case c.Xk.ZegoAudioCodecIDNormal2:t=N.AUDIO_ENC_AAC_LC;break;case c.Xk.ZegoAudioCodecIDLow3:t=N.AUDIO_ENC_OPUS;break;default:t=N.AUDIO_ENC_HE_AAC}return t}!function(e){e[e.AUDIO_ENC_HE_AAC=0]="AUDIO_ENC_HE_AAC",e[e.AUDIO_ENC_AAC_LC=1]="AUDIO_ENC_AAC_LC",e[e.AUDIO_ENC_MP3=2]="AUDIO_ENC_MP3",e[e.AUDIO_ENC_OPUS=3]="AUDIO_ENC_OPUS",e[e.AUDIO_ENC_SILK=4]="AUDIO_ENC_SILK",e[e.AUDIO_ENC_EVS=5]="AUDIO_ENC_EVS"}(N||(N={}));var L={},U={startMixerTask:function(e){var t=this;return new R.l3((function(r,n){var o,i,s,a,u,d,c,l,f,_,g,p,h,b,I=t.reporter.createSpan(D.H,{key:E.oq.event},{key:v.event,par:e.taskID},v.event,!0),S={errorCode:m.MIXER_INPUT_PARAMETERS_ERROR.code,extendedData:m.MIXER_INPUT_PARAMETERS_ERROR.message};if(!!(null==e?void 0:e.inputList.find((function(e){return null==e.streamID&&(S.extendedData=S.extendedData+". streamID should be of string type",!0)}))))return t.reporter.setError(I,m.MIXER_INPUT_PARAMETERS_ERROR),void n(S);var T=e.outputConfig;T&&T.outputFps&&(T.outputFPS=T.outputFps);var A=function(r){var o=C(t.stateCenter,r),i=o.reportErr,s=o.actualError;1000010150===r.errorCode&&I.setAttributes({stop_reason:"UnmatchStreamId"}),t.reporter.setError(I,i||r),t.reporter.spanEnd({key:v.event,par:e.taskID}),s&&(r.errorCode=null==s?void 0:s.code,r.extendedData=(null==s?void 0:s.message)||""),n(r)},N=t.stateCenter.roomList[0];if(N){var k=[];if(!e.noTaskID&&!e.taskID)return t.logger.error("zb.sh.ums no taskId found"),void A({errorCode:v.error.i.code,extendedData:v.error.i.message});if(!e.noTaskID&&!(0,x.QP)(e.taskID))return t.logger.error("zb.rh.lg taskId must be string"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!e.noTaskID&&e.taskID.length>M)return t.logger.error("zb.sh.ums taskId is too long"),void A({errorCode:v.error.u.code,extendedData:v.error.u.message});if(!e.noTaskID&&!(0,R.jy)(e.taskID))return t.logger.error("zb.sh.ums task ID contains illegal characters"),void A({errorCode:v.error.m.code,extendedData:v.error.m.message});if(!e.inputList||0==e.inputList.length)return t.logger.error("zb.sh.ums input list wrong"),void A({errorCode:v.error.l.code,extendedData:v.error.l.message});if(e.inputList.some((function(e){return(0,x.w)(e)&&!e.streamID})))return t.logger.error("zb.sh.ums input stream is null"),void A({errorCode:v.error.l.code,extendedData:v.error.l.message});for(var y=0;y<e.inputList.length;y++){var U=e.inputList[y],q={errorCode:v.error.t.code,extendedData:v.error.t.message};if(!(0,x.w)(U.layout))return t.logger.error("zb.sh.ums input layout must be object"),void A(q);var w=U.layout,P=w.bottom,X=w.left,$=w.right;if(!((0,R.zQ)(w.top,!1)&&(0,R.zQ)(P,!1)&&(0,R.zQ)(X,!1)&&(0,R.zQ)($,!1)))return t.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),void A(q);if(void 0!==U.renderMode&&![0,1].includes(U.renderMode))return t.logger.error("zb.sh.ums render_mode is wrong"),void A(q);if(void 0!==U.imageInfo){if(!(0,x.QP)(U.imageInfo.url))return t.logger.error("zb.sh.ums image url is require string"),void A(q);if(U.imageInfo.url.length>1024)return t.logger.error("zb.sh.ums input image url length too long"),void A({errorCode:v.error.T.code,extendedData:v.error.T.message})}if(!(0,x.TE)(U.label)){if(!(0,x.QP)(null===(o=U.label)||void 0===o?void 0:o.text))return t.logger.error("zb.sh.ums input label text is not string"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message+" label text is not string"});if((null===(s=null===(i=U.label)||void 0===i?void 0:i.text)||void 0===s?void 0:s.length)>=300)return t.logger.error("zb.sh.ums input label text is  too long"),void A({errorCode:v.error.D.code,extendedData:v.error.D.message});var F=U.label,j=F.left,G=F.top;if(void 0!==j&&!(0,R.zQ)(j,!1)||void 0!==G&&!(0,R.zQ)(G,!1))return t.logger.error("zb.sh.ums input label left and top should be integer"),void A(q)}if(void 0!==U.cornerRadius&&!(0,x.Cs)(U.cornerRadius))return t.logger.error("zb.sh.ums cornerRadius is wrong"),void A(q);if(void 0!==U.soundLevelID&&!(0,R.zQ)(U.soundLevelID,!1))return t.logger.error("zb.sh.ums soundLevelID is wrong"),void A(q);if(void 0!==U.volume&&!(0,R.zQ)(U.volume,!1))return t.logger.error("zb.sh.ums volume is wrong"),void A(q)}if(!e.outputList||0==e.outputList.length)return t.logger.error("zb.sh.ums no output list found"),void A({errorCode:v.error._.code,extendedData:v.error._.message});if(e.outputList.some((function(e){return(0,x.QP)(e)&&!(0,R.gU)(e)&&""===e||(0,x.w)(e)&&!e.target})))return t.logger.error("zb.sh.ums stream output target is nul"),void A({errorCode:v.error._.code,extendedData:v.error._.message});if(e.outputList.some((function(e){return(0,x.QP)(e)&&!(0,R.gU)(e)&&e.length>O||(0,x.w)(e)&&(0,x.QP)(e.target)&&e.target.length>O})))return t.logger.error("zb.sh.ums stream output target is too long"),void A({errorCode:v.error.R.code,extendedData:v.error.R.message});if(e.outputList.some((function(e){return(0,x.QP)(e)&&!(0,R.gU)(e)&&!(0,R.jy)(e)||(0,x.w)(e)&&e.target&&!(0,R.gU)(e.target)&&!(0,R.jy)(e.target)})))return t.logger.error("zb.sh.ums stream output target is incorrect"),void A({errorCode:v.error.v.code,extendedData:v.error.v.message});if(!T||!(0,x.w)(T))return t.logger.error("zb.sh.ums no output config found"),void A({errorCode:v.error.p.code,extendedData:v.error.p.message});if(!T.outputBitrate||!(0,R.zQ)(T.outputBitrate))return t.logger.error("zb.sh.ums bitrate param is required and must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!T.outputFPS||!(0,R.zQ)(T.outputFPS))return t.logger.error("zb.sh.ums fps param is required and must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!T.outputWidth||!(0,R.zQ)(T.outputWidth))return t.logger.error("zb.sh.ums width param is required and must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!T.outputHeight||!(0,R.zQ)(T.outputHeight))return t.logger.error("zb.sh.ums height param is required and must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(void 0!==T.outputAudioCodecID&&!(0,R.zQ)(T.outputAudioCodecID,!1))return t.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(void 0!==T.outputAudioBitrate&&!(0,R.zQ)(T.outputAudioBitrate))return t.logger.error("zb.sh.ums AudioBitrate param must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(void 0!==T.outputAudioChannels&&!(0,R.zQ)(T.outputAudioChannels,!1))return t.logger.error("zb.sh.ums AudioChannels param must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.TE)(e.watermark)){if(!(0,x.QP)(null===(a=e.watermark)||void 0===a?void 0:a.imageURL))return t.logger.error("zb.sh.ums watermark image type error"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.$C)(null===(u=e.watermark)||void 0===u?void 0:u.imageURL))return t.logger.error("zb.sh.ums watermark image url invalid"),void A({errorCode:v.error.N.code,extendedData:v.error.N.message});if(!(0,x.w)(null===(d=e.watermark)||void 0===d?void 0:d.layout))return t.logger.error("zb.sh.ums watermark layout must be object"),void A({errorCode:v.error.k.code,extendedData:v.error.k.message});var H=null===(c=e.watermark)||void 0===c?void 0:c.layout;P=H.bottom,X=H.left,$=H.right;if(!((0,R.zQ)(H.top,!1)&&(0,R.zQ)(P,!1)&&(0,R.zQ)(X,!1)&&(0,R.zQ)($,!1)))return t.logger.error("zb.sh.ums watermark top、left、bottom、right must be integer number"),void A({errorCode:v.error.k.code,extendedData:v.error.k.message})}if(!(0,x.TE)(e.whiteboard)){if(!(0,x.QP)(null===(l=e.whiteboard)||void 0===l?void 0:l.whiteboardID))return t.logger.error("zb.sh.ums whiteboard is required and must be string"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.w)(null===(f=e.whiteboard)||void 0===f?void 0:f.layout))return t.logger.error("zb.sh.ums whiteboard layout must be object"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});var V=null===(_=e.whiteboard)||void 0===_?void 0:_.layout;P=V.bottom,X=V.left,$=V.right;if(!((0,R.zQ)(V.top,!1)&&(0,R.zQ)(P,!1)&&(0,R.zQ)(X,!1)&&(0,R.zQ)($,!1)))return t.logger.error("zb.sh.ums whiteboard top、left、bottom、right must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});var Z=e.whiteboard,J=Z.horizontalRatio,W=Z.verticalRatio,B=Z.isPPTAnimation,K=Z.zOrder,Q=Z.backgroundColor;if(!(0,x.TE)(J)&&!(0,R.zQ)(J))return t.logger.error("zb.sh.ums horizontalRatio must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.TE)(W)&&!(0,R.zQ)(W))return t.logger.error("zb.sh.ums verticalRatio must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.TE)(B)&&!(0,x.dd)(B))return t.logger.error("zb.sh.ums isPPTAnimation must be boolean"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.TE)(K)&&!(0,R.zQ)(K,!1))return t.logger.error("zb.sh.ums zOrder must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});if(!(0,x.TE)(Q)&&!(0,R.zQ)(Q,!1))return t.logger.error("zb.sh.ums backgroundColor must be integer number"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message})}if(!(0,x.TE)(e.enableSoundLevel)&&!(0,x.dd)(e.enableSoundLevel))return t.logger.error("zb.sh.ums enableSoundLevel is not bool"),void A({errorCode:v.error.t.code,extendedData:v.error.t.message});for(y=0;y<e.inputList.length;y++){var Y=e.inputList[y],ee=Y.streamID;t.stateCenter.testEnvironment&&(ee="zegotest-"+t.stateCenter.appid+"-"+Y.streamID),k.push({stream_id:ee,content_control:z[Y.contentType||"VIDEO"]||0,top:null===(g=Y.layout)||void 0===g?void 0:g.top,left:null===(p=Y.layout)||void 0===p?void 0:p.left,bottom:null===(h=Y.layout)||void 0===h?void 0:h.bottom,right:null===(b=Y.layout)||void 0===b?void 0:b.right,render_mode:Y.renderMode,image:Y.imageInfo,label:Y.label})}var te=[];e.outputList.forEach((function(e){var t="";(0,x.QP)(e)?t=e:(0,x.w)(e)&&e.target&&(t=e.target);var r=0;(t.startsWith("rtmp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))&&(r=1),te.push({target:t,is_url:r?"true":"false"})}));t.reporter.spanSetAttributes({key:v.event,par:e.taskID},{mix_stream_conf:v.mix_stream_conf({fps:T.outputFPS,bitrate:T.outputBitrate,w:T.outputWidth,h:T.outputHeight,stream_cnt:k.length,mix_task_id:e.taskID,input_stream_list:k,output_target_list:te})}),N.streamHandler.updateMixStream(e,L,(function(n){t.reporter.spanEnd({key:v.event,par:e.taskID}),r(n)}),A)}else A({errorCode:v.error.U.code,extendedData:v.error.U.message})}))},setMixerTaskConfig:function(e){var t=this;return new R.l3((function(r,n){var o,i=t.reporter.createSpan(D.H,{key:E.oq.event},{key:""},p.event),s={},a=function(e){t.reporter.setError(i,e),n(e)};if(e&&e.videoCodec){var u=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(u))return t.logger.error("zb.sh.ums param videoCode error"),a({errorCode:p.error.q.code,extendedData:p.error.q.message}),!1;s.videoCodec=u}if(e.backgroundColor){if(!(0,R.zQ)(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),a({errorCode:p.error.t.code,extendedData:p.error.t.message}),!1;s.backgroundColor=e.backgroundColor}var d=e.backgroundImage;if(d){if(!(0,x.QP)(d))return t.logger.error("zb.sh.ums param outputBgImage error"),a({errorCode:p.error.t.code,extendedData:p.error.t.message}),!1;if(!(0,x.$C)(d))return t.logger.error("zb.sh.ums illegal input background image URL"),a({errorCode:p.error.P.code,extendedData:p.error.P.message}),!1;s.backgroundImage=d}var m=e&&e.userData;if(m){if(!(0,x.G0)(m))return t.logger.error("zb.sh.ums param userData required Uint8Array"),a({errorCode:p.error.t.code,extendedData:p.error.t.message}),!1;if(m.byteLength>1e3)return t.logger.error("zb.sh.ums param userData should shorter than 1000"),a({errorCode:p.error.t.code,extendedData:p.error.t.message}),!1;s.userData=m}e.extraParams&&(s.extraParams||(s.extraParams=[]),(o=s.extraParams).push.apply(o,e.extraParams)),L=s,i.setAttributes({mix_params:p.mix_params(e)}),t.stateCenter.roomList[0]?(i.end(),r({errorCode:0,extendedData:""})):a({errorCode:p.error.U.code,extendedData:p.error.U.message})}))},stopMixerTask:function(e){var t=this;return new R.l3((function(r,n){var o=t.reporter.createSpan(D.H,{key:E.oq.event},{key:""},g.event);if(!e||!(0,x.QP)(e)||e.length>M||!(0,R.jy)(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.reporter.setError(o,g.error.t," param taskID error"),void n({errorCode:g.error.t.code,extendedData:g.error.t.message+" param taskID error"});o.setAttributes({mix_task_id:e});var i=function(e){var r=C(t.stateCenter,e),i=r.actualError;t.reporter.setError(o,r.reportErr||e),i&&(e.errorCode=null==i?void 0:i.code,e.extendedData=(null==i?void 0:i.message)||""),n(e)},s=t.stateCenter.roomList[0];s?s.streamHandler.stopMixStream(e,(function(e){o.end(),r(e)}),i):i({errorCode:g.error.U.code,extendedData:g.error.U.message})}))},startAutoMixerTask:function(e){var t=this;return new R.l3((function(r,n){var o,i,s=t.reporter.createSpan(D.H,{key:E.oq.event},{key:h,par:e.taskID},h,!0),a=function(r){var o=C(t.stateCenter,r),i=o.reportErr;1000010150===r.errorCode&&s.setAttributes({stop_reason:"UnmatchStreamId"}),t.reporter.setError(s,i||r),t.reporter.spanEnd({key:h,par:e.taskID}),n(r)},u=t.stateCenter.roomList[0];if(u){if(!e.taskID)return t.logger.error("zb.sh.ums no taskId found"),void a({errorCode:v.error.i.code,extendedData:v.error.i.message});if(!(0,x.QP)(e.taskID))return t.logger.error("zb.rh.lg taskId must be string"),void a({errorCode:v.error.t.code,extendedData:v.error.t.message});if(e.taskID.length>M)return t.logger.error("zb.sh.ums taskId is too long"),void a({errorCode:v.error.u.code,extendedData:v.error.u.message});if(!(0,R.jy)(e.taskID))return t.logger.error("zb.sh.ums task ID contains illegal characters"),void a({errorCode:v.error.m.code,extendedData:v.error.m.message});if(!e.roomID)return t.logger.error("zb.sh.ums no roomID found"),void a({errorCode:d.Qo5.code,extendedData:d.Qo5.message});if(!(0,x.QP)(e.roomID))return t.logger.error("zb.rh.lg roomID must be string"),void a({errorCode:v.error.t.code,extendedData:v.error.t.message});if(e.roomID.length>128)return t.logger.error("zb.sh.ums roomID is too long"),void a({errorCode:d.Srw.code,extendedData:d.Srw.message});if(!(0,R.jy)(e.roomID))return t.logger.error("zb.sh.ums room ID contains illegal characters"),void a({errorCode:d.ulL.code,extendedData:d.ulL.message});if(!e.outputList||0==e.outputList.length)return t.logger.error("zb.sh.ums no output list found"),void a({errorCode:v.error._.code,extendedData:v.error._.message});if(e.outputList.some((function(e){return(0,x.w)(e)&&!e.target})))return t.logger.error("zb.sh.ums stream output target is nul"),void a({errorCode:v.error._.code,extendedData:v.error._.message});if(e.outputList.some((function(e){return(0,x.w)(e)&&(0,x.QP)(e.target)&&e.target.length>O})))return t.logger.error("zb.sh.ums stream output target is too long"),void a({errorCode:v.error.R.code,extendedData:v.error.R.message});if(e.outputList.some((function(e){return(0,x.w)(e)&&e.target&&!(0,R.gU)(e.target)&&!(0,R.jy)(e.target)})))return t.logger.error("zb.sh.ums stream output target is incorrect"),void a({errorCode:v.error.v.code,extendedData:v.error.v.message});if(e.audioConfig){if(void 0!==(null===(o=e.audioConfig)||void 0===o?void 0:o.bitrate)&&!(0,R.zQ)(null===(i=e.audioConfig)||void 0===i?void 0:i.bitrate))return t.logger.error("zb.sh.ums audio bitrate param is required and must be integer number"),void a({errorCode:v.error.t.code,extendedData:v.error.t.message});if(void 0!==e.audioConfig.codecID&&!(0,R.zQ)(e.audioConfig.codecID,!1))return t.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void a({errorCode:v.error.t.code,extendedData:v.error.t.message});if(void 0!==e.audioConfig.channel&&![1,2].includes(e.audioConfig.channel))return t.logger.error("zb.sh.ums AudioChannels param must be 1 or 2"),void a({errorCode:v.error.t.code,extendedData:v.error.t.message})}if(!(0,x.TE)(e.enableSoundLevel)&&!(0,x.dd)(e.enableSoundLevel))return t.logger.error("zb.sh.ums enableSoundLevel is not bool"),void a({errorCode:v.error.t.code,extendedData:v.error.t.message});e.outputList.forEach((function(e){var t="";(0,x.QP)(e)?t=e:(0,x.w)(e)&&e.target&&(t=e.target);t.startsWith("rtmp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8")})),t.reporter.spanSetAttributes({key:h,par:e.taskID},{task_id:e.taskID,room_id:e.roomID,with_sound_level:e.enableSoundLevel?1:0,alignment_type:e.streamAlignmentMode||0,recv_buffer_level:e.minPlayStreamBufferLength||0,output_target_list:[]}),u.streamHandler.updateAutoMixStream(e,(function(n){t.reporter.spanEnd({key:h,par:e.taskID}),r(n)}),a)}else a({errorCode:v.error.U.code,extendedData:v.error.U.message})}))},stopAutoMixerTask:function(e){var t=this;return new R.l3((function(r,n){var o=t.reporter.createSpan(D.H,{key:E.oq.event},{key:""},b);if(!e.taskID||!(0,x.QP)(e.taskID)||e.taskID.length>M||!(0,R.jy)(e.taskID))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.reporter.setError(o,g.error.t," param taskID error"),void n({errorCode:g.error.t.code,extendedData:g.error.t.message+" param taskID error"});o.setAttributes({task_id:e.taskID,room_id:e.roomID});var i=function(e){var r=C(t.stateCenter,e);t.reporter.setError(o,r.reportErr||e),n(e)},s=t.stateCenter.roomList[0];s?s.streamHandler.stopAutoMixStream(e,(function(e){o.end(),r(e)}),i):i({errorCode:g.error.U.code,extendedData:g.error.U.message})}))}},q={_sendMixStopReqByAccessHub:function(e,t,r){var n=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new f),e.timestamp=l.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.1 req "+JSON.stringify(e));var o=this.mixStreamProtoBuf.encodeMixStreamStopReq(e),i=function(t,r){try{var o=n.mixStreamProtoBuf.decodeMixStreamStopRsp(t);(0,R.M$)(o),n.logger.info("zb.sh.smseba.1 rsp "+JSON.stringify(e));var i=(null==o?void 0:o.common_response)||{};return{code:i.code,msg:i.message}}catch(e){return{code:-1}}};this.sendMixRequest({interfaceID:16},o,(function(e,n){var o=i(e),s=o.code,a=o.msg;0!=s&&null!=s||!(0,x.JO)(t)?r&&r({errorCode:s,extendedData:a||""}):t({errorCode:s,extendedData:a})}),(function(e,t,o){var s="";if(o)return o.code==m.TIMEOUT.code&&(o=v.error.S),o.code&&20010===o.code&&(o=JSON.parse(JSON.stringify(m.MIXER_NO_SERVICES))),void(r&&r(o,s));o=v.error.S;var a="";if((0,x.QP)(t))a=t;else{var u=i(t);a=u.code+" "+u.msg}n.logger.error("zb.sh.pt "+(s="request media server fail, error: "+e+" "+a)),r&&r(o,s)}))},stopMixStream:function(e,t,r,n,o){var i=this;this.logger.info("zb.sh.sms call");var s=this.getStopMixStreamParams(e,n,o);this._sendMixStopReqByAccessHub(s.mixStopReq,(function(r){i.mixStreamHbList[e]&&(i.mixStreamHbList[e].timer&&clearTimeout(i.mixStreamHbList[e].timer),delete i.mixStreamHbList[e]),t(r)}),r)},_sendMixStartReqByAccessHub:function(e,t,r,n){var o=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new f),e.timestamp=l.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.0 req "+JSON.stringify(e));var i=this.mixStreamProtoBuf.encodeMixStreamStartReq(e),s=function(e,t){try{var r=o.mixStreamProtoBuf.decodeMixStreamStartRsp(e);(0,R.M$)(r),o.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(r));var n=r.common_response;return{code:n.code,msg:n.message,data:r.data,errStreamList:r.error_streamid_list}}catch(e){return{code:-1}}};this.sendMixRequest({interfaceID:15},i,(function(i,a){var u=s(i),d=u.code,m=u.data,c=u.errStreamList;if(void 0===d||0==d){var l=m.play_infos.map((function(e){var r={rtmpURL:"",hlsURL:"",flvURL:""},n=e.stream_alias||"";return o.stateCenter.testEnvironment&&n&&n.startsWith(t)&&(n=n.slice(t.length)),r.streamID=n,e.rtmp_url&&e.rtmp_url.length>0&&(r.rtmpURL=e.rtmp_url),e.hls_url&&e.hls_url.length>0&&(r.hlsURL=e.hls_url),e.hdl_url&&e.hdl_url.length>0&&(r.flvURL=e.hdl_url),r}));if(m.request_id){o.mixStreamTaskList[e.task_id]||(o.mixStreamTaskList[e.task_id]={mixStatusVer:0,requestId:m.request_id}),o.mixStreamTaskList[e.task_id].requestId=m.request_id;var f=o.mixRequestIdList.findIndex((function(e){return e==m.request_id}));f>-1&&(o.fetchMixStreamStatus(o.stateCenter.appid+":"+e.task_id),o.mixRequestIdList.splice(f,1))}if(r)r({errorCode:0,extendedData:JSON.stringify({mixerOutputList:l})})}else{var _="",v=d+1e9;if(1000000150==v&&c){var g=c.map((function(e){return o.stateCenter.testEnvironment&&e.startsWith(t)?e.slice(t.length):e}))||[];g.length>0&&(o.logger.debug("zb.sh.ums not exist streams: "+g),_=g.join(","))}n&&n({errorCode:o.stateCenter.getServerError(S+v).code,extendedData:_})}}),(function(e,t,r){var i="";if(r)return r.code==m.TIMEOUT.code&&(r=v.error.O),r.code&&20010===r.code&&(r=JSON.parse(JSON.stringify(m.MIXER_NO_SERVICES))),void(n&&n(r,i));r=v.error.S;var a="";if((0,x.QP)(t))a=t;else{var u=s(t);a=u.code+" "+u.msg}o.logger.error("zb.sh.pt "+(i="request media server fail, error: "+e+" "+a)),n&&n(r,i)}))},getStartMixStreamParams:function(e,t){var r,n,o=this,i={request_seq:this.stateCenter.getSeq(),mix_protocol_version:1,task_id:e.taskID,room_id:this.roomID,mix_stream_common:{},input_stream:[],advance_config:[],output_stream:[]},s=e.outputConfig||{};s.singleStreamPassThrough&&(0,x.dd)(s.singleStreamPassThrough)&&(i.mix_stream_common.single_stream_pass_through=s.singleStreamPassThrough?1:0);var a=t;if(a&&(a.videoCodec&&(null===(r=i.advance_config)||void 0===r||r.push({key:"video_encode",value:a.videoCodec})),a.backgroundColor&&(i.mix_stream_common.output_bg_color=a.backgroundColor),a.backgroundImage&&(i.mix_stream_common.output_bg_image=a.backgroundImage),a.userData&&(i.mix_stream_common.user_data=this.stateCenter.uint8arrayToBase64(a.userData)),a.extraParams&&(null===(n=i.advance_config)||void 0===n||n.push.apply(n,a.extraParams))),void 0!==e.enableSoundLevel&&(i.mix_stream_common.with_sound_level=e.enableSoundLevel?1:0),e.inputList.forEach((function(e,t){var r,n,s,a,u,d,m,c,l,f,_,v,g,p,h,b,x,R,E,I,M,O=e.streamID;o.stateCenter.testEnvironment&&(O="zegotest-"+o.stateCenter.appid+"-"+e.streamID);var S={stream_input_common:{stream_id:O,content_control:z[e.contentType||"VIDEO"]||0,layer_rect:{layer:t,top:null===(r=e.layout)||void 0===r?void 0:r.top,left:null===(n=e.layout)||void 0===n?void 0:n.left,bottom:null===(s=e.layout)||void 0===s?void 0:s.bottom,right:null===(a=e.layout)||void 0===a?void 0:a.right}},volume:null!==(u=e.volume)&&void 0!==u?u:100,audio_focus:e.isAudioFocus?1:0,audio_h_angle:-1,render_mode:e.renderMode,corner_radius:e.cornerRadius};if(null===(d=e.label)||void 0===d?void 0:d.text){var D={font_type:(null===(c=null===(m=e.label)||void 0===m?void 0:m.font)||void 0===c?void 0:c.type)||0,font_size:(null===(f=null===(l=e.label)||void 0===l?void 0:l.font)||void 0===f?void 0:f.size)||24,font_color:(null===(v=null===(_=e.label)||void 0===_?void 0:_.font)||void 0===v?void 0:v.color)||16777215,font_transparency:(null===(p=null===(g=e.label)||void 0===g?void 0:g.font)||void 0===p?void 0:p.transparency)||0};D.font_border_color=(null===(b=null===(h=e.label)||void 0===h?void 0:h.font)||void 0===b?void 0:b.border)?null===(R=null===(x=e.label)||void 0===x?void 0:x.font)||void 0===R?void 0:R.borderColor:-1;var T={text:null===(E=e.label)||void 0===E?void 0:E.text,text_left:(null===(I=e.label)||void 0===I?void 0:I.left)||0,text_top:(null===(M=e.label)||void 0===M?void 0:M.top)||0,font:D};S.label=T}e.imageInfo&&(S.image={url:e.imageInfo.url,display_mode:e.imageInfo.displayMode||0}),e.soundLevelID&&(S.stream_input_common.sound_level_id=e.soundLevelID),i.input_stream.push(S)})),e.outputList.forEach((function(e){var t,r,n,u,d,m,l,f,_,v,g,p,h,b="";if((0,x.QP)(e)?b=e:(0,x.w)(e)&&e.target?b=e.target:o.logger.error("zb.sh.ums output target required"),(0,R.gU)(b))p=1,h=b;else{p=0,h=o.stateCenter.testEnvironment?"zegotest-"+o.stateCenter.appid+"-"+b:b}var E=s.outputBitrate;"string"!=typeof e&&(null===(t=e.videoConfig)||void 0===t?void 0:t.bitrate)&&(E=null===(r=e.videoConfig)||void 0===r?void 0:r.bitrate);var I={is_url:p,target:h,video_bitrate:1e3*E,video_fps:s.outputFPS,video_width:s.outputWidth,video_height:s.outputHeight,output_quality:23};s.outputAudioCodecID&&(I.audio_enc_id=s.outputAudioCodecID),"vp8"===a.videoCodec?I.audio_enc_id=3:"h264"===a.videoCodec&&(I.audio_enc_id=0),s.outputAudioBitrate&&(I.audio_bitrate=1e3*s.outputAudioBitrate);var M={output_stream_common:I};"string"!=typeof e&&((null===(n=e.videoConfig)||void 0===n?void 0:n.videoCodecID)&&(M.video_enc_id=k[null===(u=e.videoConfig)||void 0===u?void 0:u.videoCodecID]||0),(null===(d=e.videoConfig)||void 0===d?void 0:d.encodeProfile)&&[0,1,2,3].includes(null===(m=e.videoConfig)||void 0===m?void 0:m.encodeProfile)&&(M.video_encode_profile=function(e){var t=1;switch(e){case c.zN.ZegoEncodeProfileDefault:case c.zN.ZegoEncodeProfileMain:t=1;break;case c.zN.ZegoEncodeProfileBaseline:t=0;break;case c.zN.ZegoEncodeProfileHigh:t=2}return t}(null===(l=e.videoConfig)||void 0===l?void 0:l.encodeProfile)),(0,x.Cs)(null===(f=e.videoConfig)||void 0===f?void 0:f.encodeLatency)&&(M.video_encode_latency=null===(_=e.videoConfig)||void 0===_?void 0:_.encodeLatency),(0,x.dd)(null===(v=e.videoConfig)||void 0===v?void 0:v.enableLowBitrateHD)&&(M.low_bitrate_hd=(null===(g=e.videoConfig)||void 0===g?void 0:g.enableLowBitrateHD)?1:0)),i.output_stream.push(M)})),e.watermark&&(i.water_mark={image:e.watermark.imageURL,layout_rect:e.watermark.layout}),e.whiteboard){var u=e.whiteboard,d=u.horizontalRatio,m=u.verticalRatio,f=u.layout,_=u.zOrder,v=u.isPPTAnimation,g=u.backgroundColor;i.white_board={whiteboard_id:l.fromString(u.whiteboardID),horizontal_ratio:d||16,vertical_ratio:m||9,is_ppt_animation:!0===v?1:0,layout_rect:I(I({},f),{layer:_||0}),background_color:g||4059296768}}return isNaN(e.streamAlignmentMode)||(i.mix_stream_common.alignment_type=e.streamAlignmentMode),i.audio_channel_cnt=s.outputAudioChannels?s.outputAudioChannels:1,s.audioMixMode&&(i.audio_mix_mode=s.audioMixMode),{mixStartReq:i}},updateMixStream:function(e,t,r,n){var o=this;this.logger.info("zb.sh.ums call"),this.logger.info("zb.sh.ums send command");var i=this.getStartMixStreamParams(e,t).mixStartReq;return this._sendMixStartReqByAccessHub(i,"zegotest-"+this.stateCenter.appid+"-",(function(t){o.startMixHb(e.taskID),r(t)}),n),!0},updateAutoMixStream:function(e,t,r){var n=this;this.logger.info("zb.sh.uams.0 call");var o=e.taskID,i=e.roomID,s=e.audioConfig,a=e.outputList,u=e.enableSoundLevel,d=e.streamAlignmentMode,m=e.minPlayStreamBufferLength;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new f);var c=[];a.forEach((function(e){var t=e.target,r=0;(t.startsWith("rtmp://")||t.startsWith("avertp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))&&(r=1),c.push({stream_out_common:{target:t,is_url:r,audio_bitrate:(null==s?void 0:s.bitrate)?1e3*(null==s?void 0:s.bitrate):48e3,audio_enc_id:(0,x.TE)(null==s?void 0:s.codecID)?0:y(null==s?void 0:s.codecID),video_fps:1,video_bitrate:1,video_width:1,video_height:1},audio_channel_cnt:(null==s?void 0:s.channel)||1})}));var l={request_seq:this.stateCenter.getSeq(),mix_stream_common:{with_sound_level:u?1:0,alignment_type:d},room_id:i,task_id:o,output_stream:c};(0,x.Cs)(m)&&m>=0&&(l.has_recv_buffer_level=!0,l.recv_buffer_level=m),this.logger.info("zb.sh.uams.0 params "+JSON.stringify(l));var _=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStartReq(l),v=function(e,t){try{var r=n.mixStreamProtoBuf.decodeAutoRoomMixStreamStartRsp(e);(0,R.M$)(r),n.logger.info("zb.sh.uams.0 rsp "+JSON.stringify(r));var o=r.common_response;return{code:o.code,msg:o.message}}catch(e){return{code:-1}}};return this.sendMixRequest({interfaceID:10},_,(function(e,o){n.mixSucFun(e,t,r,v,"zb.sh.uams.0")}),(function(e,t,o){n.mixFailFun(e,t,o,r,v,"zb.sh.uams.0")}),6),!0},stopAutoMixStream:function(e,t,r){var n=this,o=e.taskID,i=e.roomID,s={request_seq:this.stateCenter.getSeq(),room_id:i,task_id:o};this.logger.info("zb.sh.uams.1 params "+JSON.stringify(s));var a=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStopReq(s),u=function(e,t){try{var r=n.mixStreamProtoBuf.decodeAutoRoomMixStreamStopRsp(e);(0,R.M$)(r),n.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(r));var o=r.common_response;return{code:o.code,msg:o.message}}catch(e){return{code:-1}}};this.sendMixRequest({interfaceID:11},a,(function(e,o){n.mixSucFun(e,t,r,u,"zb.sh.uams.1")}),(function(e,t,o){n.mixFailFun(e,t,o,r,u,"zb.sh.uams.1")}),6)},mixSucFun:function(e,t,r,n,o,i){var s=n(e,i),a=s.code,u=s.msg;void 0===a||0===a?(this.logger.info(o+" suc"),t&&t({errorCode:0,extendedData:""})):(this.logger.info(o+" fail "+a+" "+u),r&&r({errorCode:this.stateCenter.getServerError(S+(a+1e9)).code,extendedData:u}))},mixFailFun:function(e,t,r,n,o,i){var s="";if(r)return r.code==m.TIMEOUT.code&&(r=v.error.S),r.code&&20010===r.code&&(r=JSON.parse(JSON.stringify(m.MIXER_NO_SERVICES))),void(n&&n(r,s));r=v.error.S;var a="";if((0,x.QP)(t))a=t;else{var u=o(t);a=u.code+" "+u.msg}s="request media server fail, error: "+e+" "+a,this.logger.error("".concat(i," http fail ").concat(s)),n&&n(r,s)},getStopMixStreamParams:function(e,t,r){var n={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:"3.7.4"},o={request_seq:this.stateCenter.getSeq(),room_id:this.roomID};if((0,x.QP)(e)&&(n.task_id=e,o.task_id=e),null!=t){var i=void 0;n.stream_id=i=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+t:t,o.is_url=0,o.target=i}else null!=r&&(n.mixurl=r,o.is_url=1,o.target=r);return{req_body:n,mixStopReq:o}},getMixStreamStatus:function(e){this.logger.info("zb.sh.fmss call");for(var t=0;t<e.length;t++){var r=e[t],n=r.trans_type.replace("mixpushstatus:",""),o=n.replace(this.stateCenter.appid+":",""),i=this.mixStreamTaskList[o],s=JSON.parse(r.trans_data),a=s.request_id;if(i&&i.requestId===a){var u=parseInt(s.version);u<=i.mixStatusVer&&1!=u?this.logger.info("zb.sh.fmss data ver is not new"):this.fetchMixStreamStatus(n)}else this.logger.info("zb.sh.fmss taskId don't exist"),this.mixRequestIdList.push(a)}},fetchMixStreamStatus:function(e){var t=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new f);var r={request_seq:this.stateCenter.getSeq(),task_id:e},n=this.mixStreamProtoBuf.encodeGetMixStreamStatusReq(r),o=e.replace(this.stateCenter.appid+":","");this.sendMixRequest({interfaceID:13},n,(function(e,r){var n=function(e){try{var r=t.mixStreamProtoBuf.decodeGetMixStreamStatusRsp(e);(0,R.M$)(r),t.logger.info("zb.sh.fmss rsp "+JSON.stringify(r));var n=r.common_response;return{code:n.code,msg:n.message,push_url:r.push_url,request_seq:r.request_seq,task_id:r.task_id,version:r.version}}catch(e){return{code:-1}}}(e),i=n.code,s=n.msg,a=n.push_url,u=n.task_id,d=n.version;if(void 0!==i&&0!==i||!(0,x.Cs)(d))t.logger.warn("zb.sh.fmss fail "+i+" "+s);else{var m=t.mixStreamTaskList[o];if(!m)return void t.logger.info("zb.sh.fmss taskId don't exist");if(d<=m.mixStatusVer&&1!=d)return void t.logger.warn("zb.sh.fmss data ver is not new");m.mixStatusVer=d;var c=[];a.forEach((function(e){c.push({url:e.url,state:T[e.status],updateReason:A[e.reason],stateTime:l.isLong(e.mod_time)?e.mod_time.toNumber():e.mod_time})})),t.stateCenter.actionListener("mixerRelayCDNStateUpdate",u,c)}}),(function(e,r,n){t.logger.warn("zb.sh.fmss http fail "+e+" "+JSON.stringify(n))}))},startMixHb:function(e){var t=this;this.logger.info("zb.sh.smh.0 call");var r={request_seq:this.stateCenter.getSeq(),task_id:"".concat(e)},n=this.mixStreamProtoBuf.encodeMixStreamTaskHbReq(r);this.sendMixRequest({interfaceID:12},n,(function(r,n){var o=function(e){try{var r=t.mixStreamProtoBuf.decodeMixStreamTaskHbRsp(e);(0,R.M$)(r),t.logger.info("zb.sh.smh.0 rsp "+JSON.stringify(r));var n=r.common_response;return{code:n.code,msg:n.message,status:r.status,hb_interval:r.hb_interval}}catch(e){return{code:-1}}}(r),i=o.code,s=o.msg,a=o.status,u=o.hb_interval;void 0===i||0===i?(t.logger.info("zb.sh.smh.0 suc ".concat(a," ").concat(u)),(0,x.Cs)(u)&&0===a&&(!t.mixStreamHbList[e]&&(t.mixStreamHbList[e]={}),t.mixStreamHbList[e].timer=setTimeout((function(){t.startMixHb(e)}),1e3*u))):t.logger.info("zb.sh.smh.0 fail ".concat(i," ").concat(s))}),(function(e,r,n){t.logger.info("zb.sh.smh.0 send err ".concat(e," ").concat(n))}))}},w={type:"MixStream",install:function(e,t){for(var r in U)Object.defineProperty(e.prototype,r,{value:U[r],writable:!1});for(var r in q)Object.defineProperty(t.prototype,r,{value:q[r],writable:!1})}};return i}()}));